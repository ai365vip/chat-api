{"version":3,"sources":["../src/sankey-highlight.ts"],"names":[],"mappings":"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","file":"sankey-highlight.js","sourcesContent":["import { InteractionStateEnum, BaseInteraction } from '@visactor/vgrammar-core';\nimport type {\n  IElement,\n  IGlyphElement,\n  IMark,\n  IView,\n  InteractionEvent,\n  SankeyHighlightOptions\n} from '@visactor/vgrammar-core';\nimport { array } from '@visactor/vutils';\nimport type { SankeyLinkDatum, SankeyLinkElement, SankeyNodeElement } from './interface';\n\nexport class SankeyHighlight extends BaseInteraction<SankeyHighlightOptions> {\n  static type: string = 'sankey-highlight';\n  type: string = SankeyHighlight.type;\n\n  static defaultOptions: SankeyHighlightOptions = {\n    highlightState: InteractionStateEnum.highlight,\n    blurState: InteractionStateEnum.blur,\n    trigger: 'pointerover',\n    resetTrigger: 'pointerout',\n    effect: 'related'\n  };\n  options: SankeyHighlightOptions;\n  protected _nodeMark?: IMark;\n  protected _linkMark?: IMark;\n  protected _activeElement?: IElement | IGlyphElement;\n\n  constructor(view: IView, options?: SankeyHighlightOptions) {\n    super(view, options);\n    this.options = Object.assign({}, SankeyHighlight.defaultOptions, options);\n\n    this._nodeMark = view.getMarksBySelector(this.options.nodeSelector)?.[0];\n    this._linkMark = view.getMarksBySelector(this.options.linkSelector)?.[0];\n  }\n\n  protected getEvents() {\n    return [\n      {\n        type: this.options.trigger,\n        handler: this.handleStart\n      },\n      { type: this.options.resetTrigger, handler: this.handleReset }\n    ];\n  }\n\n  clearPrevElements() {\n    [this._linkMark, this._nodeMark].forEach(mark => {\n      if (!mark) {\n        return;\n      }\n      mark.elements.forEach(el => {\n        if (el.hasState(this.options.highlightState)) {\n          el.removeState(this.options.highlightState);\n        }\n\n        if (el.hasState(this.options.blurState)) {\n          el.removeState(this.options.blurState);\n        }\n      });\n    });\n  }\n\n  parseUpstreamLinks(element: IElement, isNode: boolean) {\n    const datum = element.getDatum();\n    const links = isNode ? (datum as SankeyNodeElement).targetLinks : array(datum as SankeyLinkDatum);\n\n    return links.reduce((res: any[], link: any) => {\n      const dividedLinks = array((link as any).datum);\n\n      dividedLinks.forEach(dividedLink => {\n        const parents = dividedLink.parents ?? [{ key: dividedLink.source }];\n        const len = isNode ? parents.length : parents.length - 1;\n\n        for (let i = 0; i < len; i++) {\n          const source = parents[i].key;\n          const target = parents[i + 1] ? parents[i + 1].key : datum.key;\n          const value = dividedLink.value;\n\n          // 检查 res 数组中是否已存在相同的 source 和 target\n          const existingItem = res.find(item => item.source === source && item.target === target);\n\n          if (existingItem) {\n            // 如果存在相同的项，则对其 value 进行累加\n            existingItem.value += value;\n          } else {\n            // 如果不存在相同的项，则添加新的项到 res 数组中\n            res.push({ source, target, value });\n          }\n        }\n      });\n      return res;\n    }, []);\n  }\n\n  highlightAdjacentElement = (element: IElement, isNode: boolean) => {\n    const datum = element.getDatum();\n    const allLinkElements = this._linkMark?.elements ?? [];\n    const highlightNodes: (string | number)[] = isNode ? [datum.key] : [datum.source, datum.target];\n    const getIsHighlight = isNode\n      ? (linkDatum: SankeyLinkElement) => {\n          return linkDatum.target === datum.key || linkDatum.source === datum.key;\n        }\n      : (linkDatum: SankeyLinkElement) => {\n          return linkDatum.source === datum.source && linkDatum.target === datum.target;\n        };\n\n    allLinkElements.forEach(linkEl => {\n      const linkDatum = linkEl.getDatum() as SankeyLinkElement;\n\n      if (getIsHighlight(linkDatum)) {\n        linkEl.removeState(this.options.blurState);\n        linkEl.addState(this.options.highlightState, { ratio: 1 });\n\n        if (!highlightNodes.includes(linkDatum.source)) {\n          highlightNodes.push(linkDatum.source);\n        }\n        if (!highlightNodes.includes(linkDatum.target)) {\n          highlightNodes.push(linkDatum.target);\n        }\n      } else {\n        linkEl.removeState(this.options.highlightState);\n        linkEl.addState(this.options.blurState);\n      }\n    });\n    return highlightNodes;\n  };\n\n  highlightRelatedBySourceTarget = (element: IElement, isNode: boolean) => {\n    if (!isNode) {\n      return this.highlightAdjacentElement(element, isNode);\n    }\n\n    const datum = element.getDatum() as SankeyNodeElement;\n    const allNodeElements = this._nodeMark?.elements ?? [];\n    const highlightNodes: (string | number)[] = [];\n    const allLinkElements = this._linkMark?.elements ?? [];\n    const highlightLinks: SankeyLinkElement[] = [];\n    const allNodes = allNodeElements.reduce((res, nodeEl) => {\n      const nodeDatum = nodeEl.getDatum() as SankeyNodeElement;\n\n      res[nodeDatum?.key] = { datum: nodeDatum, el: nodeEl };\n      return res;\n    }, {});\n    const downNodes: SankeyNodeElement[] = [datum];\n    const upNodes: SankeyNodeElement[] = [datum];\n\n    while (downNodes.length) {\n      const first = downNodes.pop();\n\n      if (first?.sourceLinks?.length) {\n        first.sourceLinks.forEach(link => {\n          highlightLinks.push(link);\n\n          if (allNodes[link.target]) {\n            downNodes.push(allNodes[link.target].datum);\n          }\n        });\n      }\n    }\n\n    while (upNodes.length) {\n      const first = upNodes.pop();\n\n      if (first?.targetLinks?.length) {\n        first.targetLinks.forEach(link => {\n          highlightLinks.push(link);\n\n          if (allNodes[link.source]) {\n            upNodes.push(allNodes[link.source].datum);\n          }\n        });\n      }\n    }\n\n    allLinkElements.forEach(linkEl => {\n      const linkDatum = linkEl.getDatum();\n\n      if (highlightLinks.some(link => link.source === linkDatum.source && link.target === linkDatum.target)) {\n        linkEl.removeState(this.options.blurState);\n        linkEl.addState(this.options.highlightState, { ratio: 1 });\n\n        if (!highlightNodes.includes(linkDatum.source)) {\n          highlightNodes.push(linkDatum.source);\n        }\n\n        if (!highlightNodes.includes(linkDatum.target)) {\n          highlightNodes.push(linkDatum.target);\n        }\n      } else {\n        linkEl.removeState(this.options.highlightState);\n        linkEl.addState(this.options.blurState);\n      }\n    });\n\n    return highlightNodes;\n  };\n\n  highlightRelatedElement = (element: IElement, isNode: boolean) => {\n    const allLinkElements = this._linkMark?.elements ?? [];\n    const isHierarchyData = !!allLinkElements[0]?.getDatum?.()?.parents;\n\n    if (!isHierarchyData) {\n      return this.highlightRelatedBySourceTarget(element, isNode);\n    }\n\n    const datum = element.getDatum();\n    const highlightNodes: string[] = isNode ? [datum.key] : [datum.source, datum.target];\n    const upstreamLinks = this.parseUpstreamLinks(element, isNode);\n\n    allLinkElements.forEach(linkEl => {\n      const linkDatum = linkEl.getDatum();\n      const originalDatum = array(linkDatum.datum) as SankeyLinkElement[];\n\n      if (!isNode && linkDatum.source === datum.source && linkDatum.target === datum.target) {\n        linkEl.removeState(this.options.blurState);\n        linkEl.addState(this.options.highlightState, { ratio: 1 });\n        return;\n      }\n\n      const selectedDatum = isNode\n        ? originalDatum.filter((entry: any) => (entry.parents ?? []).some((par: any) => par.key === datum.key))\n        : originalDatum.filter((entry: any) => (entry.parents ?? []).some((par: any) => par.key === datum.target));\n\n      if (selectedDatum && selectedDatum.length) {\n        // 下游link\n        if (!highlightNodes.includes(linkDatum.source)) {\n          highlightNodes.push(linkDatum.source);\n        }\n\n        if (!highlightNodes.includes(linkDatum.target)) {\n          highlightNodes.push(linkDatum.target);\n        }\n\n        const val = selectedDatum.reduce((sum: number, d: any) => {\n          return (sum += d.value);\n        }, 0);\n        const ratio = val / linkDatum.value;\n\n        linkEl.removeState(this.options.blurState);\n        linkEl.addState(this.options.highlightState, { ratio });\n\n        return;\n      }\n\n      const upSelectedLink = upstreamLinks.find(\n        (upLink: any) => upLink.source === linkDatum.source && upLink.target === linkDatum.target\n      );\n\n      if (upSelectedLink) {\n        // 点击节点的上游一层的节点\n        if (!highlightNodes.includes(linkDatum.source)) {\n          highlightNodes.push(linkDatum.source);\n        }\n        if (!highlightNodes.includes(linkDatum.target)) {\n          highlightNodes.push(linkDatum.target);\n        }\n\n        linkEl.removeState(this.options.blurState);\n        linkEl.addState(this.options.highlightState, { ratio: upSelectedLink.value / linkDatum.value });\n\n        return;\n      }\n\n      linkEl.removeState(this.options.highlightState);\n      linkEl.addState(this.options.blurState);\n\n      return;\n    });\n\n    return highlightNodes;\n  };\n\n  highlightElement = (element: IElement, isNode: boolean) => {\n    const allNodeElements = this._nodeMark?.elements ?? [];\n    const highlightNodes =\n      this.options.effect === 'related'\n        ? this.highlightRelatedElement(element, isNode)\n        : this.highlightAdjacentElement(element, isNode);\n    allNodeElements.forEach(el => {\n      if (highlightNodes.includes(el.getDatum().key)) {\n        el.removeState(this.options.blurState);\n        el.addState(this.options.highlightState);\n      } else {\n        el.removeState(this.options.highlightState);\n        el.addState(this.options.blurState);\n      }\n    });\n  };\n\n  handleStart = (e: InteractionEvent) => {\n    if (!e.element) {\n      return;\n    }\n\n    if (e.element.mark === this._nodeMark) {\n      this._activeElement = e.element;\n      this.highlightElement(e.element, true);\n    } else if (e.element.mark === this._linkMark) {\n      this._activeElement = e.element;\n      this.highlightElement(e.element, false);\n    }\n  };\n\n  handleReset = (e: InteractionEvent) => {\n    if (e.element && e.element === this._activeElement) {\n      this.clearPrevElements();\n    }\n  };\n}\n"]}