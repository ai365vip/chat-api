{"version":3,"sources":["../src/interactions/scrollbar-filter.ts"],"names":[],"mappings":"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","file":"scrollbar-filter.js","sourcesContent":["import type { DataFilterOptions, IComponent, IScrollbar, IView, ScrollbarFilterValue } from '../types';\nimport { DataFilterRank, GrammarMarkType } from '../graph/enums';\nimport { isString } from '@visactor/vutils';\nimport { Filter } from './filter';\n\nexport class ScrollbarFilter extends Filter {\n  static type: string = 'scrollbar-filter';\n  type: string = ScrollbarFilter.type;\n\n  static defaultOptions: Omit<DataFilterOptions, 'target'> = {};\n  options: DataFilterOptions;\n\n  constructor(view: IView, options?: DataFilterOptions) {\n    super(view, options);\n    this.options = Object.assign({}, ScrollbarFilter.defaultOptions, options);\n\n    this._marks = view\n      .getMarksBySelector(this.options.source)\n      .filter(\n        mark => mark.markType === GrammarMarkType.component && (mark as IComponent).componentType === 'scrollbar'\n      );\n    this._data = isString(this.options.target.data)\n      ? view.getDataById(this.options.target.data)\n      : this.options.target.data;\n  }\n\n  protected getEvents() {\n    if (!this._marks || this._marks.length === 0) {\n      return [];\n    }\n\n    const scrollbar = this._marks[0] as IScrollbar;\n\n    if (!this._data || !scrollbar) {\n      return [];\n    }\n\n    const filter = this.options.target.filter;\n    const transform = this.options.target.transform;\n\n    const getFilterValue = (event: any) => {\n      if (isString(filter)) {\n        const range = event.detail.value;\n        const scaleGrammar = scrollbar.getScale();\n        if (scaleGrammar) {\n          const scale = scaleGrammar.getScale();\n          const scaleRange = scale.range();\n          const start = scale.invert(range[0] * (scaleRange[1] - scaleRange[0]) + scaleRange[0]);\n          const end = scale.invert(range[1] * (scaleRange[1] - scaleRange[0]) + scaleRange[0]);\n          return { start, end, startRatio: range[0], endRatio: range[1] };\n        }\n        return { startRatio: range[0], endRatio: range[1] };\n      }\n      return { startRatio: event.detail.value[0], endRatio: event.detail.value[1] };\n    };\n    const dataFilter = isString(filter)\n      ? (datum: any, filterValue: ScrollbarFilterValue) => {\n          const scaleGrammar = scrollbar.getScale();\n          const scale = scaleGrammar.getScale();\n          const range = scale.range();\n          const datumRatio = (scale.scale(datum[filter]) - range[0]) / (range[range.length - 1] - range[0]);\n          return filterValue.startRatio <= datumRatio && filterValue.endRatio >= datumRatio;\n        }\n      : filter;\n\n    this._filterData(this._data, scrollbar, DataFilterRank.scrollbar, getFilterValue, dataFilter, transform);\n\n    return [\n      {\n        type: 'scroll',\n        handler: this.handleFilter\n      }\n    ];\n  }\n}\n"]}