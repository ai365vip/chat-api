{"version":3,"sources":["../src/view/animate.ts"],"names":[],"mappings":"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","file":"animate.js","sourcesContent":["import { HOOK_EVENT } from '../graph/enums';\nimport type { IView, AnimationEvent, IMark, IAnimationConfig, IViewAnimate } from '../types';\n\nexport class ViewAnimate implements IViewAnimate {\n  private _view: IView;\n  // animation start/end events are triggered on specific animation configuration\n  private _animations: { config: IAnimationConfig; mark: IMark }[] = [];\n  private _additionalAnimateMarks: IMark[] = [];\n  private isEnabled: boolean = true;\n\n  constructor(view: IView) {\n    this._view = view;\n\n    this._view.addEventListener(HOOK_EVENT.ANIMATION_START, this._onAnimationStart);\n    this._view.addEventListener(HOOK_EVENT.ANIMATION_END, this._onAnimationEnd);\n  }\n\n  stop() {\n    this._view.traverseMarkTree(mark => {\n      mark.animate && mark.animate.stop?.();\n    });\n    this._additionalAnimateMarks.forEach(mark => {\n      // if mark is not released\n      if (mark.view && mark.animate) {\n        mark.animate.stop?.();\n      }\n    });\n    // clear all additional animate marks after animations are stopped\n    this._additionalAnimateMarks = [];\n    return this;\n  }\n\n  pause() {\n    this._view.traverseMarkTree(mark => {\n      mark.animate && mark.animate.pause?.();\n    });\n    this._additionalAnimateMarks.forEach(mark => {\n      // if mark is not released\n      if (mark.view && mark.animate) {\n        mark.animate.pause?.();\n      }\n    });\n    return this;\n  }\n\n  resume() {\n    this._view.traverseMarkTree(mark => {\n      mark.animate && mark.animate.resume?.();\n    });\n    this._additionalAnimateMarks.forEach(mark => {\n      // if mark is not released\n      if (mark.view && mark.animate) {\n        mark.animate.resume?.();\n      }\n    });\n    return this;\n  }\n\n  enable() {\n    this.isEnabled = true;\n    this._view.traverseMarkTree(mark => {\n      mark.animate && mark.animate.enable?.();\n    });\n    return this;\n  }\n\n  disable() {\n    this.isEnabled = false;\n    this._view.traverseMarkTree(mark => {\n      mark.animate && mark.animate.disable?.();\n    });\n    // stop all addition animations when animate is disabled\n    this._additionalAnimateMarks.forEach(mark => {\n      // if mark is not released\n      if (mark.view && mark.animate) {\n        mark.animate.stop?.();\n      }\n    });\n    // clear all additional animate marks after animations are stopped\n    this._additionalAnimateMarks = [];\n    return this;\n  }\n\n  enableAnimationState(state: string | string[]) {\n    this._view.traverseMarkTree(mark => {\n      mark.animate && mark.animate.enableAnimationState?.(state);\n    });\n    return this;\n  }\n\n  disableAnimationState(state: string | string[]) {\n    this._view.traverseMarkTree(mark => {\n      mark.animate && mark.animate.disableAnimationState?.(state);\n    });\n    return this;\n  }\n\n  isAnimating() {\n    return (\n      this._animations.length !== 0 || this._additionalAnimateMarks.some(mark => mark?.animate?.isAnimating() || false)\n    );\n  }\n\n  animate() {\n    if (!this.isEnabled) {\n      return this;\n    }\n\n    this._view.traverseMarkTree(\n      mark => {\n        if (mark.isUpdated && mark.animate) {\n          mark.animate.animate();\n        }\n        mark.cleanExitElements();\n        mark.isUpdated = false;\n      },\n      null,\n      true\n    );\n    return this;\n  }\n\n  animateAddition(additionMark: IMark) {\n    additionMark.animate.animate();\n    this._additionalAnimateMarks.push(additionMark);\n    return this;\n  }\n\n  private _onAnimationStart = (event: AnimationEvent) => {\n    this._additionalAnimateMarks = this._additionalAnimateMarks.filter(mark => mark?.animate?.isAnimating());\n\n    if (this._animations.length === 0 && this._additionalAnimateMarks.length === 0) {\n      this._view.emit(HOOK_EVENT.ALL_ANIMATION_START, {});\n    }\n    this._animations = this._animations.concat({ config: event.animationConfig, mark: event.mark });\n  };\n\n  private _onAnimationEnd = (event: AnimationEvent) => {\n    this._additionalAnimateMarks = this._additionalAnimateMarks.filter(mark => mark?.animate?.isAnimating());\n\n    this._animations = this._animations.filter(animation => {\n      return animation.config !== event.animationConfig || animation.mark !== event.mark;\n    });\n    if (this._animations.length === 0 && this._additionalAnimateMarks.length === 0) {\n      this._view.emit(HOOK_EVENT.ALL_ANIMATION_END, {});\n    }\n  };\n\n  release() {\n    this._additionalAnimateMarks = [];\n    this._view.removeEventListener(HOOK_EVENT.ALL_ANIMATION_START, this._onAnimationStart);\n    this._view.removeEventListener(HOOK_EVENT.ALL_ANIMATION_END, this._onAnimationEnd);\n  }\n}\n"]}