{"version":3,"sources":["../src/core/global.ts"],"names":[],"mappings":"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","file":"global.js","sourcesContent":["import { inject, injectable, named } from '../common/inversify-lite';\n// eslint-disable-next-line @typescript-eslint/consistent-type-imports\nimport { ContributionProvider } from '../common/contribution-provider';\nimport type {\n  CreateDOMParamsType,\n  EnvType,\n  IContributionProvider,\n  ICreateCanvasParams,\n  IEnvContribution,\n  IEnvParamsMap,\n  IGlobal,\n  ISyncHook\n} from '../interface';\nimport { SyncHook } from '../tapable';\nimport { EnvContribution } from '../constants';\nimport type { IAABBBoundsLike } from '@visactor/vutils';\nimport { container } from '../container';\nimport { Generator } from '../common/generator';\n\nconst defaultEnv: EnvType = 'browser';\n@injectable()\nexport class DefaultGlobal implements IGlobal {\n  readonly id: number;\n  private _env: EnvType;\n  private _isSafari?: boolean;\n  private _isChrome?: boolean;\n  get env(): EnvType {\n    return this._env;\n  }\n  private envContribution: IEnvContribution;\n\n  get devicePixelRatio(): number {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.getDevicePixelRatio();\n  }\n\n  get supportEvent(): boolean {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.supportEvent;\n  }\n\n  set supportEvent(support: boolean) {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    this.envContribution.supportEvent = support;\n  }\n\n  get supportsTouchEvents(): boolean {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.supportsTouchEvents;\n  }\n\n  set supportsTouchEvents(support: boolean) {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    this.envContribution.supportsTouchEvents = support;\n  }\n\n  get supportsPointerEvents(): boolean {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.supportsPointerEvents;\n  }\n\n  set supportsPointerEvents(support: boolean) {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    this.envContribution.supportsPointerEvents = support;\n  }\n\n  get supportsMouseEvents(): boolean {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.supportsMouseEvents;\n  }\n\n  set supportsMouseEvents(support: boolean) {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    this.envContribution.supportsMouseEvents = support;\n  }\n\n  get applyStyles(): boolean {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.applyStyles;\n  }\n\n  set applyStyles(support: boolean) {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    this.envContribution.applyStyles = support;\n  }\n\n  // 是否在不显示canvas的时候停止绘图操作，默认false\n  optimizeVisible: boolean;\n\n  envParams?: any;\n  declare measureTextMethod: 'native' | 'simple' | 'quick';\n  declare hooks: {\n    onSetEnv: ISyncHook<[EnvType | undefined, EnvType, IGlobal]>;\n  };\n\n  constructor(\n    // todo: 不需要创建，动态获取就行？\n    @inject(ContributionProvider)\n    @named(EnvContribution)\n    protected readonly contributions: IContributionProvider<IEnvContribution>\n  ) {\n    this.id = Generator.GenAutoIncrementId();\n    this.hooks = {\n      onSetEnv: new SyncHook<[EnvType | undefined, EnvType, IGlobal]>(['lastEnv', 'env', 'global'])\n    };\n    this.measureTextMethod = 'native';\n    this.optimizeVisible = false;\n  }\n\n  protected bindContribution(params?: any): void | Promise<any> {\n    const promiseArr: any[] = [];\n    this.contributions.getContributions().forEach(contribution => {\n      const data = contribution.configure(this, params);\n      if ((data as any) && (data as any).then) {\n        promiseArr.push(data);\n      }\n    });\n    if (promiseArr.length) {\n      return Promise.all(promiseArr);\n    }\n  }\n\n  /**\n   * 获取动态canvas的数量，offscreenCanvas或者framebuffer\n   */\n  getDynamicCanvasCount(): number {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.getDynamicCanvasCount();\n  }\n\n  /**\n   * 获取静态canvas的数量，纯粹canvas\n   */\n  getStaticCanvasCount(): number {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.getStaticCanvasCount();\n  }\n\n  /**\n   * 设置当前环境\n   * @param env\n   * @param params 环境参数\n   * 默认重复设置不生效，但如果params.force为true那么每次设置env都会重复执行初始化逻辑\n   * @returns\n   */\n  setEnv(env: EnvType, params?: IEnvParamsMap[EnvType]): void | Promise<any> {\n    // 如果环境设置过了，但是没有设置force为true，就直接跳过\n    if (!(params && params.force === true) && this._env === env) {\n      return;\n    }\n    this.deactiveCurrentEnv();\n    return this.activeEnv(env, params);\n  }\n\n  protected deactiveCurrentEnv() {\n    this.envContribution && this.envContribution.release();\n  }\n\n  protected activeEnv(env: EnvType, params?: IEnvParamsMap[EnvType]): void | Promise<any> {\n    const lastEnv = this._env;\n    this._env = env;\n    const data = this.bindContribution(params);\n    if (data && data.then) {\n      return data.then(() => {\n        this.envParams = params;\n        this.hooks.onSetEnv.call(lastEnv, env, this);\n      });\n    }\n    this.envParams = params;\n    this.hooks.onSetEnv.call(lastEnv, env, this);\n  }\n\n  setActiveEnvContribution(contribution: IEnvContribution) {\n    this.envContribution = contribution;\n  }\n\n  createCanvas(params: ICreateCanvasParams) {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.createCanvas(params);\n  }\n\n  createOffscreenCanvas(params: ICreateCanvasParams) {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.createOffscreenCanvas(params);\n  }\n\n  releaseCanvas(canvas: HTMLCanvasElement | string | any) {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.releaseCanvas(canvas);\n  }\n\n  addEventListener<K extends keyof DocumentEventMap>(\n    type: K,\n    listener: (this: Document, ev: DocumentEventMap[K]) => any,\n    options?: boolean | AddEventListenerOptions\n  ): void;\n  addEventListener(\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions\n  ): void {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.addEventListener(type, listener, options);\n  }\n  removeEventListener<K extends keyof DocumentEventMap>(\n    type: K,\n    listener: (this: Document, ev: DocumentEventMap[K]) => any,\n    options?: boolean | EventListenerOptions\n  ): void;\n  removeEventListener(\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | EventListenerOptions\n  ): void {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.removeEventListener(type, listener, options);\n  }\n  dispatchEvent(event: any): boolean {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.dispatchEvent(event);\n  }\n\n  getRequestAnimationFrame() {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.getRequestAnimationFrame();\n  }\n\n  getCancelAnimationFrame() {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    return this.envContribution.getCancelAnimationFrame();\n  }\n\n  getElementById(str: string): HTMLElement | null {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    if (!this.envContribution.getElementById) {\n      return null;\n    }\n    return this.envContribution.getElementById(str);\n  }\n\n  getRootElement(): HTMLElement | null {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    if (!this.envContribution.getRootElement) {\n      return null;\n    }\n    return this.envContribution.getRootElement();\n  }\n\n  getDocument(): Document | null {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    if (!this.envContribution.getDocument) {\n      return null;\n    }\n    return this.envContribution.getDocument();\n  }\n\n  mapToCanvasPoint(event: any, domElement?: any) {\n    if (!this._env) {\n      this.setEnv(defaultEnv);\n    }\n    if (!this.envContribution.mapToCanvasPoint) {\n      return null;\n    }\n    return this.envContribution.mapToCanvasPoint(event, domElement);\n  }\n\n  loadImage(url: string) {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.loadImage(url);\n  }\n\n  loadSvg(str: string) {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.loadSvg(str);\n  }\n\n  loadJson(url: string) {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.loadJson(url);\n  }\n\n  loadArrayBuffer(url: string) {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.loadArrayBuffer(url);\n  }\n\n  loadBlob(url: string) {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.loadBlob(url);\n  }\n\n  isChrome(): boolean {\n    if (this._isChrome != null) {\n      return this._isChrome;\n    }\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    this._isChrome = this._env === 'browser' && navigator.userAgent.indexOf('Chrome') > -1;\n    return this._isChrome;\n  }\n\n  isSafari(): boolean {\n    if (this._isSafari != null) {\n      return this._isSafari;\n    }\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    this._isSafari =\n      this._env === 'browser' && /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);\n    return this._isSafari;\n  }\n\n  getNativeAABBBounds(dom: string | HTMLElement | any): IAABBBoundsLike {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.getNativeAABBBounds(dom);\n  }\n\n  removeDom(dom: HTMLElement): boolean {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.removeDom(dom);\n  }\n\n  createDom(params: CreateDOMParamsType): HTMLElement | null {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.createDom(params);\n  }\n\n  getElementTop(dom: any, baseWindow: boolean = false): number {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.getElementTop(dom, baseWindow);\n  }\n  getElementLeft(dom: any, baseWindow: boolean = false): number {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.getElementLeft(dom, baseWindow);\n  }\n  getElementTopLeft(dom: any, baseWindow: boolean = false): { top: number; left: number } {\n    if (!this._env) {\n      this.setEnv('browser');\n    }\n    return this.envContribution.getElementTopLeft(dom, baseWindow);\n  }\n}\n"]}