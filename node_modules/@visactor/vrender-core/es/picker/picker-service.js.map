{"version":3,"sources":["../src/picker/picker-service.ts"],"names":[],"mappings":";;;;;;;;;;;;AACA,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,kBAAkB,CAAC;AACjD,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,MAAM,0BAA0B,CAAC;AACrE,OAAO,EAAE,OAAO,EAAE,MAAM,gBAAgB,CAAC;AAEzC,OAAO,EAAE,oBAAoB,EAAE,MAAM,iCAAiC,CAAC;AAcvE,OAAO,EAAE,gBAAgB,EAAE,QAAQ,EAAE,UAAU,EAAE,gBAAgB,EAAE,MAAM,YAAY,CAAC;AACtF,OAAO,EAAE,YAAY,EAAE,cAAc,EAAE,MAAM,8BAA8B,CAAC;AAC5E,OAAO,EAAE,mBAAmB,EAAE,MAAM,oBAAoB,CAAC;AACzD,OAAO,EAAE,WAAW,EAAE,MAAM,gBAAgB,CAAC;AAGtC,IAAe,kBAAkB,GAAjC,MAAe,kBAAkB;IAOtC,YAIqB,gCAAyF;QAAzF,qCAAgC,GAAhC,gCAAgC,CAAyD;QAV9G,SAAI,GAAW,SAAS,CAAC;QAYvB,IAAI,CAAC,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC;IACnC,CAAC;IAES,KAAK;QACb,IAAI,CAAC,wBAAwB,GAAG,IAAI,CAAC,gCAAgC;aAClE,gBAAgB,EAAE;aAClB,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;IACvC,CAAC;IAMD,IAAI,CAAC,QAAoB,EAAE,KAAa,EAAE,MAAmB;QAC3D,IAAI,MAAM,GAAe;YACvB,OAAO,EAAE,IAAI;YACb,KAAK,EAAE,IAAI;SACZ,CAAC;QACF,MAAM,CAAC,aAAa,GAAG,IAAI,CAAC;QAC5B,IAAI,OAAO,GAAG,CAAC,CAAC;QAChB,IAAI,OAAO,GAAG,CAAC,CAAC;QAChB,IAAI,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE;YAC3B,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE;gBAC7C,OAAO,MAAM,CAAC;aACf;YACD,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC;YAC3B,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC;SAC5B;QACD,IAAI,IAAI,CAAC,WAAW,EAAE;YACpB,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,IAAI,CAAC;SAC/B;QACD,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;QACtC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QAE1D,MAAM,YAAY,GAAG,IAAI,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;QAC9D,IAAI,KAAa,CAAC;QAClB,KAAK,IAAI,CAAC,GAAG,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;YAC7C,IAAI,QAAQ,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE;gBAC3B,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAW,EAAE,KAAK,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC;aAC7E;iBAAM;gBACL,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC;aAClE;YACD,IAAI,MAAM,CAAC,OAAO,EAAE;gBAClB,MAAM;aACP;YACD,IAAI,CAAC,KAAK,EAAE;gBACV,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;aACtB;SACF;QACD,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;YACnB,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;SACtB;QACD,IAAI,IAAI,CAAC,WAAW,EAAE;YACpB,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,KAAK,CAAC;SAChC;QAGD,IAAI,MAAM,CAAC,OAAO,EAAE;YAClB,IAAI,CAAC,GAAG,MAAM,CAAC,OAAO,CAAC;YACvB,OAAO,CAAC,CAAC,MAAM,EAAE;gBACf,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC;aACd;YACD,IAAI,CAAC,CAAC,UAAU,EAAE;gBAChB,MAAM,CAAC,MAAM,GAAG;oBACd,YAAY,EAAE,MAAM,CAAC,OAAO;iBAC7B,CAAC;gBACF,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC,UAAU,CAAC;aAC/B;SACF;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,aAAa,CAAC,OAAiB,EAAE,KAAiB,EAAE,MAAmB;;QACrE,OAAO,CAAC,CAAC,CAAA,MAAA,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,aAAN,MAAM,cAAN,MAAM,GAAI,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,0CAC1G,OAAO,CAAA,CAAC;IACd,CAAC;IAGD,SAAS,CAAC,KAAa,EAAE,KAAiB,EAAE,YAAqB,EAAE,MAAmB;QACpF,IAAI,MAAM,GAAe;YACvB,KAAK,EAAE,IAAI;YACX,OAAO,EAAE,IAAI;SACd,CAAC;QACF,IAAI,KAAK,CAAC,SAAS,CAAC,UAAU,KAAK,KAAK,EAAE;YACxC,OAAO,MAAM,CAAC;SACf;QACD,MAAM,OAAO,GAAG,MAAM,CAAC,WAAW,CAAC;QACnC,MAAM,UAAU,GAAG,OAAO,CAAC,WAAW,CAAC;QAEvC,IAAI,OAAO,CAAC,MAAM,EAAE;YAClB,MAAM,CAAC,GAAG,KAAK,CAAC,WAAW,CAAC;YAC5B,MAAM,MAAM,GAAG,YAAY,CAAC,QAAQ,EAAE,CAAC;YACvC,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACtB,IAAI,UAAU,EAAE;gBACd,IAAI,MAAM,EAAE;oBACV,MAAM,CAAC,GAAG,YAAY,CAAC,QAAQ,EAAE,CAAC;oBAClC,OAAO,CAAC,WAAW,GAAG,gBAAgB,CAAC,CAAC,EAAE,UAAU,EAAE,MAAM,CAAC,CAAC;oBAC9D,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;iBAC3B;aACF;iBAAM;gBAEL,UAAU,CAAC,MAAM,EAAE,KAAK,CAAC,iBAAiB,CAAC,CAAC;gBAC5C,OAAO,CAAC,WAAW,GAAG,MAAM,CAAC;aAC9B;SACF;QAED,IAAI,IAAI,CAAC,wBAAwB,CAAC,MAAM,EAAE;YACxC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,wBAAwB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC7D,MAAM,gBAAgB,GAAG,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC,CAAC;gBAC1D,IAAI,gBAAgB,CAAC,cAAc,EAAE;oBACnC,MAAM,MAAM,GAAG,gBAAgB,CAAC,cAAc,CAAC,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE,YAAY,EAAE,CAAC,CAAC;oBAC7F,IAAI,MAAM,EAAE;wBACV,IAAI,OAAO,CAAC,WAAW,KAAK,UAAU,EAAE;4BACtC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;yBACxC;wBACD,OAAO,CAAC,WAAW,GAAG,UAAU,CAAC;wBACjC,OAAO,MAAM,CAAC;qBACf;iBACF;aACF;SACF;QAED,MAAM,WAAW,GAAG,KAAK,CAAC,WAAW,CAAC;QACtC,MAAM,kBAAkB,GAAG,cAAc,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;QACtE,MAAM,QAAQ,GAAW,IAAI,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QACrD,kBAAkB,CAAC,cAAc,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAEtD,MAAM,WAAW,GAAG,KAAK,CAAC,UAAU,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAE7D,IAAI,CAAC,WAAW,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE;YACvC,OAAO,MAAM,CAAC;SACf;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,KAAK,EAAE,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC;QAChF,IAAI,UAAU,IAAI,UAAU,CAAC,OAAO,EAAE;YACpC,MAAM,CAAC,OAAO,GAAG,UAAU,CAAC,OAAO,CAAC;YACpC,MAAM,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC;SACnC;QACD,MAAM,WAAW,GAAG,KAAK,CAAC,SAAS,CAAC,QAAQ,KAAK,KAAK,IAAI,WAAW,CAAC;QAEtE,kBAAkB,CAAC,QAAQ,CACzB,WAAW,CAAC,CAAC,EACb,WAAW,CAAC,CAAC,EACb,WAAW,CAAC,CAAC,EACb,WAAW,CAAC,CAAC,EACb,WAAW,CAAC,CAAC,EACb,WAAW,CAAC,CAAC,CACd,CAAC;QACF,IAAI,KAAK,CAAC,SAAS,CAAC,gBAAgB,KAAK,KAAK,IAAI,CAAC,CAAC,UAAU,IAAI,UAAU,CAAC,OAAO,CAAC,EAAE;YACrF,OAAO,CACL,KAAK,EACL,gBAAgB,CAAC,MAAM,EACvB,CAAC,OAAiB,EAAE,EAAE;gBACpB,IAAI,OAAO,CAAC,WAAW,EAAE;oBAEvB,MAAM,QAAQ,GAAW,IAAI,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;oBACrD,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC;oBACpC,MAAM,EAAE,OAAO,GAAG,KAAK,CAAC,OAAO,EAAE,OAAO,GAAG,KAAK,CAAC,OAAO,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC;oBAC7E,QAAQ,CAAC,CAAC,IAAI,OAAO,CAAC;oBACtB,QAAQ,CAAC,CAAC,IAAI,OAAO,CAAC;oBACtB,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,OAAiB,EAAE,QAAQ,EAAE,kBAAkB,EAAE,MAAM,CAAC,CAAC;iBAClF;qBAAM;oBACL,MAAM,QAAQ,GAAW,IAAI,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;oBACrD,kBAAkB,CAAC,cAAc,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;oBAEtD,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC;oBACpC,MAAM,EAAE,OAAO,GAAG,KAAK,CAAC,OAAO,EAAE,OAAO,GAAG,KAAK,CAAC,OAAO,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC;oBAC7E,QAAQ,CAAC,CAAC,IAAI,OAAO,CAAC;oBACtB,QAAQ,CAAC,CAAC,IAAI,OAAO,CAAC;oBACtB,MAAM,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,QAAQ,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC;oBAC1E,IAAI,UAAU,IAAI,UAAU,CAAC,OAAO,EAAE;wBACpC,MAAM,CAAC,OAAO,GAAG,UAAU,CAAC,OAAO,CAAC;wBACpC,MAAM,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC;qBACnC;iBACF;gBACD,OAAO,CAAC,CAAC,MAAM,CAAC,OAAO,IAAI,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC;YAC5C,CAAC,EACD,IAAI,EACJ,CAAC,CAAC,OAAO,CAAC,MAAM,CACjB,CAAC;SACH;QACD,IAAI,OAAO,CAAC,WAAW,KAAK,UAAU,EAAE;YACtC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;SACxC;QACD,OAAO,CAAC,WAAW,GAAG,UAAU,CAAC;QAEjC,IAAI,CAAC,MAAM,CAAC,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,IAAI,WAAW,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE;YAC1E,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;SACtB;QACD,cAAc,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACxC,OAAO,MAAM,CAAC;IAChB,CAAC;IAUS,YAAY,CAAC,OAAiB;QACtC,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QACtD,IAAI,CAAC,MAAM,EAAE;YACX,OAAO,IAAI,CAAC;SACb;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;CACF,CAAA;AA7NqB,kBAAkB;IADvC,UAAU,EAAE;IAUR,WAAA,MAAM,CAAC,oBAAoB,CAAC,CAAA;IAC5B,WAAA,KAAK,CAAC,mBAAmB,CAAC,CAAA;;GAVT,kBAAkB,CA6NvC;SA7NqB,kBAAkB","file":"picker-service.js","sourcesContent":["import type { IMatrix, IPoint, IPointLike } from '@visactor/vutils';\nimport { Matrix, Point } from '@visactor/vutils';\nimport { inject, injectable, named } from '../common/inversify-lite';\nimport { foreach } from '../common/sort';\n// eslint-disable-next-line @typescript-eslint/consistent-type-imports\nimport { ContributionProvider } from '../common/contribution-provider';\nimport type {\n  IContext2d,\n  IGraphic,\n  IGroup,\n  EnvType,\n  IGlobal,\n  IPickerService,\n  IGraphicPicker,\n  IPickParams,\n  PickResult,\n  IPickItemInterceptorContribution,\n  IContributionProvider\n} from '../interface';\nimport { DefaultAttribute, getTheme, mat3Tomat4, multiplyMat4Mat4 } from '../graphic';\nimport { mat4Allocate, matrixAllocate } from '../allocator/matrix-allocate';\nimport { PickItemInterceptor } from './pick-interceptor';\nimport { application } from '../application';\n\n@injectable()\nexport abstract class DefaultPickService implements IPickerService {\n  type: string = 'default';\n  declare pickerMap: Map<number, IGraphicPicker>;\n  declare pickContext?: IContext2d;\n  declare InterceptorContributions: IPickItemInterceptorContribution[];\n  declare global: IGlobal;\n\n  constructor(\n    // 拦截器\n    @inject(ContributionProvider)\n    @named(PickItemInterceptor)\n    protected readonly pickItemInterceptorContributions: IContributionProvider<IPickItemInterceptorContribution>\n  ) {\n    this.global = application.global;\n  }\n\n  protected _init() {\n    this.InterceptorContributions = this.pickItemInterceptorContributions\n      .getContributions()\n      .sort((a, b) => a.order - b.order);\n  }\n\n  abstract configure(global: IGlobal, env: EnvType): void;\n\n  // todo: params支持\n  // todo: 性能优化\n  pick(graphics: IGraphic[], point: IPoint, params: IPickParams): PickResult {\n    let result: PickResult = {\n      graphic: null,\n      group: null\n    };\n    params.pickerService = this;\n    let offsetX = 0;\n    let offsetY = 0;\n    if (params && params.bounds) {\n      if (!params.bounds.contains(point.x, point.y)) {\n        return result;\n      }\n      offsetX = params.bounds.x1;\n      offsetY = params.bounds.y1;\n    }\n    if (this.pickContext) {\n      this.pickContext.inuse = true;\n    }\n    params.pickContext = this.pickContext;\n    this.pickContext && this.pickContext.clearMatrix(true, 1);\n\n    const parentMatrix = new Matrix(1, 0, 0, 1, offsetX, offsetY);\n    let group: IGroup;\n    for (let i = graphics.length - 1; i >= 0; i--) {\n      if (graphics[i].isContainer) {\n        result = this.pickGroup(graphics[i] as IGroup, point, parentMatrix, params);\n      } else {\n        result = this.pickItem(graphics[i], point, parentMatrix, params);\n      }\n      if (result.graphic) {\n        break;\n      }\n      if (!group) {\n        group = result.group;\n      }\n    }\n    if (!result.graphic) {\n      result.group = group;\n    }\n    if (this.pickContext) {\n      this.pickContext.inuse = false;\n    }\n\n    // 判断是否有shadow-dom\n    if (result.graphic) {\n      let g = result.graphic;\n      while (g.parent) {\n        g = g.parent;\n      }\n      if (g.shadowHost) {\n        result.params = {\n          shadowTarget: result.graphic\n        };\n        result.graphic = g.shadowHost;\n      }\n    }\n    return result;\n  }\n\n  containsPoint(graphic: IGraphic, point: IPointLike, params: IPickParams): boolean {\n    return !!this.pickItem(graphic, point, null, params ?? { pickContext: this.pickContext, pickerService: this })\n      ?.graphic;\n  }\n\n  // TODO: 支持3d模式的拾取和自定义path的拾取\n  pickGroup(group: IGroup, point: IPointLike, parentMatrix: IMatrix, params: IPickParams): PickResult {\n    let result: PickResult = {\n      group: null,\n      graphic: null\n    };\n    if (group.attribute.visibleAll === false) {\n      return result;\n    }\n    const context = params.pickContext;\n    const lastMatrix = context.modelMatrix;\n    // 如果是3d，那么需要生成modelMatrix\n    if (context.camera) {\n      const m = group.transMatrix;\n      const matrix = mat4Allocate.allocate();\n      mat3Tomat4(matrix, m);\n      if (lastMatrix) {\n        if (matrix) {\n          const m = mat4Allocate.allocate();\n          context.modelMatrix = multiplyMat4Mat4(m, lastMatrix, matrix);\n          mat4Allocate.free(matrix);\n        }\n      } else {\n        // 转化context的matrix为lastMatrix\n        mat3Tomat4(matrix, group.globalTransMatrix);\n        context.modelMatrix = matrix;\n      }\n    }\n    // 添加拦截器\n    if (this.InterceptorContributions.length) {\n      for (let i = 0; i < this.InterceptorContributions.length; i++) {\n        const drawContribution = this.InterceptorContributions[i];\n        if (drawContribution.beforePickItem) {\n          const result = drawContribution.beforePickItem(group, this, point, params, { parentMatrix });\n          if (result) {\n            if (context.modelMatrix !== lastMatrix) {\n              mat4Allocate.free(context.modelMatrix);\n            }\n            context.modelMatrix = lastMatrix;\n            return result;\n          }\n        }\n      }\n    }\n    // 转换坐标空间\n    const transMatrix = group.transMatrix;\n    const currentGroupMatrix = matrixAllocate.allocateByObj(parentMatrix);\n    const newPoint: IPoint = new Point(point.x, point.y);\n    currentGroupMatrix.transformPoint(newPoint, newPoint);\n    // todo: 支持带有path的group的选中\n    const insideGroup = group.AABBBounds.containsPoint(newPoint);\n    // 如果group没有被选中，直接跳过（如果是3d模式，那么继续）\n    if (!insideGroup && !group.stage.camera) {\n      return result;\n    }\n    // pickGroup，Group目前只支持拦截模式（用于shadow节点）\n    const pickedItem = this.pickItem(group, newPoint.clone(), parentMatrix, params);\n    if (pickedItem && pickedItem.graphic) {\n      result.graphic = pickedItem.graphic;\n      result.params = pickedItem.params;\n    }\n    const groupPicked = group.attribute.pickable !== false && insideGroup;\n\n    currentGroupMatrix.multiply(\n      transMatrix.a,\n      transMatrix.b,\n      transMatrix.c,\n      transMatrix.d,\n      transMatrix.e,\n      transMatrix.f\n    );\n    if (group.attribute.childrenPickable !== false && !(pickedItem && pickedItem.graphic)) {\n      foreach(\n        group,\n        DefaultAttribute.zIndex,\n        (graphic: IGraphic) => {\n          if (graphic.isContainer) {\n            // 偏移scrollX和scrollY\n            const newPoint: IPoint = new Point(point.x, point.y);\n            const theme = getTheme(group).group;\n            const { scrollX = theme.scrollX, scrollY = theme.scrollY } = group.attribute;\n            newPoint.x -= scrollX;\n            newPoint.y -= scrollY;\n            result = this.pickGroup(graphic as IGroup, newPoint, currentGroupMatrix, params);\n          } else {\n            const newPoint: IPoint = new Point(point.x, point.y);\n            currentGroupMatrix.transformPoint(newPoint, newPoint);\n            // 偏移scrollX和scrollY\n            const theme = getTheme(group).group;\n            const { scrollX = theme.scrollX, scrollY = theme.scrollY } = group.attribute;\n            newPoint.x -= scrollX;\n            newPoint.y -= scrollY;\n            const pickedItem = this.pickItem(graphic, newPoint, parentMatrix, params);\n            if (pickedItem && pickedItem.graphic) {\n              result.graphic = pickedItem.graphic;\n              result.params = pickedItem.params;\n            }\n          }\n          return !!result.graphic || !!result.group;\n        },\n        true,\n        !!context.camera\n      );\n    }\n    if (context.modelMatrix !== lastMatrix) {\n      mat4Allocate.free(context.modelMatrix);\n    }\n    context.modelMatrix = lastMatrix;\n\n    if (!result.graphic && !result.group && groupPicked && !group.stage.camera) {\n      result.group = group;\n    }\n    matrixAllocate.free(currentGroupMatrix);\n    return result;\n  }\n\n  // todo: switch统一改为数字map\n  abstract pickItem(\n    graphic: IGraphic,\n    point: IPointLike,\n    parentMatrix: IMatrix | null,\n    params: IPickParams\n  ): PickResult | null;\n\n  protected selectPicker(graphic: IGraphic): IGraphicPicker | null {\n    const picker = this.pickerMap.get(graphic.numberType);\n    if (!picker) {\n      return null;\n    }\n    return picker;\n  }\n}\n"]}