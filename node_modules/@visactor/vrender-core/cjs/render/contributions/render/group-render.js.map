{"version":3,"sources":["../src/render/contributions/render/group-render.ts"],"names":[],"mappings":"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","file":"group-render.js","sourcesContent":["import { inject, injectable, named } from '../../../common/inversify-lite';\nimport type {\n  IGraphicAttribute,\n  IContext2d,\n  IGroup,\n  IMarkAttribute,\n  IThemeAttribute,\n  IGroupRenderContribution,\n  IDrawContext,\n  IRenderService,\n  IGraphicRender,\n  IGraphicRenderDrawParams,\n  IContributionProvider\n} from '../../../interface';\nimport { getModelMatrix, getTheme, multiplyMat4Mat4 } from '../../../graphic';\nimport { isArray } from '@visactor/vutils';\n// eslint-disable-next-line @typescript-eslint/consistent-type-imports\nimport { ContributionProvider } from '../../../common/contribution-provider';\nimport { createRectPath } from '../../../common/shape/rect';\nimport { rectFillVisible, rectStrokeVisible, runFill, runStroke } from './utils';\nimport { GroupRenderContribution } from './contributions/constants';\nimport { mat4Allocate } from '../../../allocator/matrix-allocate';\nimport { GROUP_NUMBER_TYPE } from '../../../graphic/constants';\nimport { BaseRenderContributionTime } from '../../../common/enums';\nimport { defaultGroupBackgroundRenderContribution } from './contributions';\n\n@injectable()\nexport class DefaultCanvasGroupRender implements IGraphicRender {\n  type: 'group';\n  numberType: number = GROUP_NUMBER_TYPE;\n\n  _groupRenderContribitions: IGroupRenderContribution[];\n\n  constructor(\n    @inject(ContributionProvider)\n    @named(GroupRenderContribution)\n    protected readonly groupRenderContribitions: IContributionProvider<IGroupRenderContribution>\n  ) {}\n\n  drawShape(\n    group: IGroup,\n    context: IContext2d,\n    x: number,\n    y: number,\n    drawContext: IDrawContext,\n    params?: IGraphicRenderDrawParams,\n    fillCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean,\n    strokeCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean\n  ) {\n    // const groupAttribute = graphicService.themeService.getCurrentTheme().groupAttribute;\n    const groupAttribute = getTheme(group, params?.theme).group;\n    const {\n      fill = groupAttribute.fill,\n      background,\n      stroke = groupAttribute.stroke,\n      opacity = groupAttribute.opacity,\n      width = groupAttribute.width,\n      height = groupAttribute.height,\n      clip = groupAttribute.clip,\n      fillOpacity = groupAttribute.fillOpacity,\n      strokeOpacity = groupAttribute.strokeOpacity,\n      cornerRadius = groupAttribute.cornerRadius,\n      path = groupAttribute.path,\n      lineWidth = groupAttribute.lineWidth,\n      visible = groupAttribute.visible\n    } = group.attribute;\n\n    // 不绘制或者透明\n    const fVisible = rectFillVisible(opacity, fillOpacity, width, height, fill);\n    const sVisible = rectStrokeVisible(opacity, strokeOpacity, width, height);\n    const doFill = runFill(fill, background);\n    const doStroke = runStroke(stroke, lineWidth);\n\n    if (!(group.valid && visible)) {\n      return;\n    }\n\n    if (!clip) {\n      if (!(doFill || doStroke)) {\n        return;\n      }\n\n      // 如果存在fillCb和strokeCb，那就不直接跳过\n      if (!(fVisible || sVisible || fillCb || strokeCb || background)) {\n        return;\n      }\n    }\n\n    if (path && path.length && drawContext.drawContribution) {\n      // 禁用fill和stroke\n      const disableFill = context.disableFill;\n      const disableStroke = context.disableStroke;\n      const disableBeginPath = context.disableBeginPath;\n      context.disableFill = true;\n      context.disableStroke = true;\n      context.disableBeginPath = true;\n      path.forEach(g => {\n        const rc = drawContext.drawContribution.getRenderContribution(g);\n        rc.draw(g, drawContext.renderService, drawContext, params);\n      });\n      context.disableFill = disableFill;\n      context.disableStroke = disableStroke;\n      context.disableBeginPath = disableBeginPath;\n    } else if (cornerRadius === 0 || (isArray(cornerRadius) && (<number[]>cornerRadius).every(num => num === 0))) {\n      // 不需要处理圆角\n      context.beginPath();\n      context.rect(x, y, width, height);\n    } else {\n      context.beginPath();\n      // 测试后，cache对于重绘性能提升不大，但是在首屏有一定性能损耗，因此rect不再使用cache\n      createRectPath(context, x, y, width, height, cornerRadius);\n    }\n\n    if (!this._groupRenderContribitions) {\n      this._groupRenderContribitions = this.groupRenderContribitions.getContributions() || [];\n      this._groupRenderContribitions.push(defaultGroupBackgroundRenderContribution);\n    }\n\n    const doFillOrStroke = {\n      doFill,\n      doStroke\n    };\n\n    this._groupRenderContribitions.forEach(c => {\n      if (c.time === BaseRenderContributionTime.beforeFillStroke) {\n        // c.useStyle && context.setCommonStyle(group, group.attribute, x, y, groupAttribute);\n        c.drawShape(\n          group,\n          context,\n          x,\n          y,\n          doFill,\n          doStroke,\n          fVisible,\n          sVisible,\n          groupAttribute,\n          drawContext,\n          fillCb,\n          strokeCb,\n          doFillOrStroke\n        );\n      }\n    });\n\n    // beforeFillStroke contribition可以操作clip范围\n    if (clip) {\n      context.clip();\n    }\n\n    // shadow\n    context.setShadowBlendStyle && context.setShadowBlendStyle(group, group.attribute, groupAttribute);\n\n    if (doFillOrStroke.doFill) {\n      if (fillCb) {\n        fillCb(context, group.attribute, groupAttribute);\n      } else if (fVisible) {\n        context.setCommonStyle(group, group.attribute, x, y, groupAttribute);\n        context.fill();\n      }\n    }\n    if (doFillOrStroke.doStroke) {\n      if (strokeCb) {\n        strokeCb(context, group.attribute, groupAttribute);\n      } else if (sVisible) {\n        context.setStrokeStyle(group, group.attribute, x, y, groupAttribute);\n        context.stroke();\n      }\n    }\n\n    this._groupRenderContribitions.forEach(c => {\n      if (c.time === BaseRenderContributionTime.afterFillStroke) {\n        // c.useStyle && context.setCommonStyle(group, group.attribute, x, y, groupAttribute);\n        c.drawShape(\n          group,\n          context,\n          x,\n          y,\n          doFill,\n          doStroke,\n          fVisible,\n          sVisible,\n          groupAttribute,\n          drawContext,\n          fillCb,\n          strokeCb\n        );\n      }\n    });\n  }\n\n  draw(group: IGroup, renderService: IRenderService, drawContext: IDrawContext, params?: IGraphicRenderDrawParams) {\n    const { context } = drawContext;\n    if (!context) {\n      return;\n    }\n    // debugger;\n    const { clip } = group.attribute;\n    if (clip) {\n      context.save();\n    } else {\n      context.highPerformanceSave();\n    }\n\n    const groupAttribute = getTheme(group, params?.theme).group;\n\n    // const lastMatrix = context.modelMatrix;\n    // if (context.camera) {\n    //   const m = group.transMatrix;\n    //   const matrix = createMat4();\n    //   mat3Tomat4(matrix, m);\n    //   const lastModelMatrix = context.modelMatrix;\n    //   if (lastModelMatrix) {\n    //     if (matrix) {\n    //       const m = createMat4();\n    //       context.modelMatrix = multiplyMat4Mat4(m, lastModelMatrix, matrix);\n    //     }\n    //   } else {\n    //     context.modelMatrix = matrix;\n    //   }\n    // } else {\n    //   // group直接transform\n    //   context.transformFromMatrix(group.transMatrix, true);\n    // }\n    const lastModelMatrix = context.modelMatrix;\n    const camera = context.camera;\n    if (camera) {\n      const nextModelMatrix = mat4Allocate.allocate();\n      // 计算模型矩阵\n      const modelMatrix = mat4Allocate.allocate();\n      getModelMatrix(modelMatrix, group, groupAttribute);\n      if (lastModelMatrix) {\n        multiplyMat4Mat4(nextModelMatrix, lastModelMatrix, modelMatrix);\n      } else {\n        multiplyMat4Mat4(nextModelMatrix, nextModelMatrix, modelMatrix);\n      }\n      context.modelMatrix = nextModelMatrix;\n      mat4Allocate.free(modelMatrix);\n      context.setTransform(1, 0, 0, 1, 0, 0, true);\n    } else {\n      // group直接transform\n      context.transformFromMatrix(group.transMatrix, true);\n    }\n\n    context.beginPath();\n    // 如果跳过绘制，那就不绘制\n    if (params.skipDraw) {\n      this.drawShape(\n        group,\n        context,\n        0,\n        0,\n        drawContext,\n        params,\n        () => false,\n        () => false\n      );\n    } else {\n      this.drawShape(group, context, 0, 0, drawContext);\n    }\n\n    // 绘制子元素的时候要添加scroll\n    const { scrollX = groupAttribute.scrollX, scrollY = groupAttribute.scrollY } = group.attribute;\n    if (scrollX || scrollY) {\n      context.translate(scrollX, scrollY);\n    }\n    let p: any;\n    if (params && params.drawingCb) {\n      p = params.drawingCb();\n    }\n\n    if (context.modelMatrix !== lastModelMatrix) {\n      mat4Allocate.free(context.modelMatrix);\n    }\n    context.modelMatrix = lastModelMatrix;\n\n    if (p && p.then) {\n      p.then(() => {\n        if (clip) {\n          context.restore();\n        } else {\n          context.highPerformanceRestore();\n        }\n      });\n    } else {\n      if (clip) {\n        context.restore();\n      } else {\n        context.highPerformanceRestore();\n      }\n    }\n  }\n}\n"]}