{"version":3,"sources":["../src/series/correlation/correlation.ts"],"names":[],"mappings":"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","file":"correlation.js","sourcesContent":["import { PolarSeries } from '../polar/polar';\nimport type { ICorrelationSeriesSpec } from './interface';\nimport { SeriesMarkNameEnum, SeriesTypeEnum } from '../interface/type';\nimport type { SeriesMarkMap } from '../interface';\nimport { correlationSeriesMark } from './constant';\nimport type { ISymbolMark } from '../../mark/symbol';\nimport { registerDataSetInstanceTransform, registerDataSetInstanceParser } from '../../data/register';\nimport { correlation } from '../../data/transforms/correlation';\nimport { correlationCenter } from '../../data/transforms/correlation-center';\n// eslint-disable-next-line no-duplicate-imports\nimport type { ICorrelationOpt } from '../../data/transforms/correlation';\nimport type { IBounds } from '@visactor/vutils';\n// eslint-disable-next-line no-duplicate-imports\nimport { Bounds, isValid } from '@visactor/vutils';\nimport { registerSymbolMark } from '../../mark/symbol';\nimport { SeriesData } from '../base/series-data';\nimport type { Maybe, Datum, ISymbolMarkSpec, IRippleMarkSpec, AdaptiveSpec } from '../../typings';\n// eslint-disable-next-line no-duplicate-imports\nimport type { ICorrelationSeriesTheme } from './interface';\nimport { AttributeLevel, DEFAULT_DATA_INDEX, LayoutZIndex } from '../../constant';\nimport { DataView, DataSet, dataViewParser } from '@visactor/vdataset';\nimport { STATE_VALUE_ENUM } from '../../compile/mark/interface';\nimport type { IRippleMark } from '../../mark/ripple';\nimport { registerRippleMark } from '../../mark/ripple';\n// eslint-disable-next-line no-duplicate-imports\nimport { RippleMark } from '../../mark/ripple';\nimport type { ILabelMark } from '../../mark/label';\n// eslint-disable-next-line no-duplicate-imports\nimport { CORRELATION_X, CORRELATION_Y, CORRELATION_SIZE } from '../../constant';\nimport { animationConfig, userAnimationConfig } from '../../animation/utils';\nimport { Factory } from '../../core/factory';\nimport { registerCorrelationAnimation, type CorrelationAppearPreset } from './animation';\nimport type { IStateAnimateSpec } from '../../animation/spec';\nimport type { IMark } from '../../mark/interface';\nimport { CorrelationSeriesSpecTransformer } from './correlation-transformer';\n\nexport class CorrelationSeries<T extends ICorrelationSeriesSpec = ICorrelationSeriesSpec> extends PolarSeries<\n  AdaptiveSpec<T, 'outerRadius' | 'innerRadius'>\n> {\n  static readonly type: string = SeriesTypeEnum.correlation;\n  type = SeriesTypeEnum.correlation;\n\n  static readonly mark: SeriesMarkMap = correlationSeriesMark;\n  static readonly transformerConstructor = CorrelationSeriesSpecTransformer as any;\n  readonly transformerConstructor = CorrelationSeriesSpecTransformer;\n\n  protected _centerSeriesData: SeriesData;\n\n  private _nodePointMark: ISymbolMark;\n  private _ripplePointMark: IRippleMark;\n  private _centerPointMark: ISymbolMark;\n\n  private _viewBox: IBounds = new Bounds();\n\n  protected _categoryField!: string;\n  getCategoryField() {\n    return this._categoryField;\n  }\n  setCategoryField(f: string): string {\n    this._categoryField = f;\n    return this._categoryField;\n  }\n\n  protected _valueField!: string;\n  getValueField() {\n    return this._valueField;\n  }\n  setValueField(f: string): string {\n    this._valueField = f;\n    return this._valueField;\n  }\n\n  protected _seriesField?: string;\n  getSeriesField() {\n    return this._seriesField;\n  }\n  setSeriesField(field: string) {\n    if (isValid(field)) {\n      this._seriesField = field;\n    }\n  }\n\n  protected _sizeField?: ICorrelationSeriesSpec['sizeField'];\n  getSizeField() {\n    return this._sizeField;\n  }\n  setSizeField(field: string) {\n    if (isValid(field)) {\n      this._sizeField = field;\n    }\n  }\n\n  protected _sizeRange?: ICorrelationSeriesSpec['sizeRange'];\n  getSizeRange() {\n    return this._sizeRange;\n  }\n  setSizeRange(range: number[]) {\n    if (isValid(range)) {\n      this._sizeRange = range;\n    }\n  }\n\n  protected _viewDataTransform!: SeriesData;\n\n  setAttrFromSpec() {\n    super.setAttrFromSpec();\n\n    this.setCategoryField(this._spec.categoryField);\n    this.setValueField(this._spec.valueField);\n\n    this.setSeriesField(this._spec.seriesField);\n    this.setSizeField(this._spec.sizeField);\n    this.setSizeRange(this._spec.sizeRange);\n  }\n\n  protected initData() {\n    super.initData();\n\n    if (!this._data) {\n      return;\n    }\n\n    registerDataSetInstanceTransform(this._dataSet, 'correlation', correlation);\n\n    const centerDataSet = new DataSet();\n    registerDataSetInstanceParser(centerDataSet, 'dataview', dataViewParser);\n    registerDataSetInstanceTransform(centerDataSet, 'correlationCenter', correlationCenter);\n    const centerDataView = new DataView(centerDataSet, { name: `${this.type}_${this.id}_center` });\n    centerDataView.parse([this.getViewData()], {\n      type: 'dataview'\n    });\n    centerDataView.transform({\n      type: 'correlationCenter',\n      options: {\n        keyword: this._spec.centerLabel?.style?.text ?? '',\n        categoryField: this._spec.categoryField\n      }\n    });\n\n    this._centerSeriesData = new SeriesData(this._option, centerDataView);\n  }\n\n  protected _statisticViewData(): void {\n    super._statisticViewData();\n    this._data.getDataView().transform({\n      type: 'correlation',\n      options: {\n        view: () => {\n          return {\n            x0: this._viewBox.x1,\n            x1: this._viewBox.x2,\n            y0: this._viewBox.y1,\n            y1: this._viewBox.y2\n          };\n        },\n        field: this._spec.valueField,\n        radiusRange: this._spec.sizeRange as [number, number],\n        radiusField: this._spec.sizeField,\n        center: [this._spec.centerX, this._spec.centerY],\n        innerRadius: this._spec.innerRadius,\n        outerRadius: this._spec.outerRadius,\n        startAngle: this._spec.startAngle,\n        endAngle: this._spec.endAngle\n      } as ICorrelationOpt\n    });\n  }\n\n  initMark(): void {\n    const nodePointMark = this._createMark(CorrelationSeries.mark.nodePoint, {\n      groupKey: this._seriesField,\n      isSeriesMark: true,\n      key: DEFAULT_DATA_INDEX,\n      customShape: this._spec.nodePoint?.customShape\n    }) as ISymbolMark;\n    if (nodePointMark) {\n      nodePointMark.setZIndex(LayoutZIndex.Node);\n      this._nodePointMark = nodePointMark;\n    }\n\n    const ripplePointMark = this._createMark(CorrelationSeries.mark.ripplePoint, {\n      key: DEFAULT_DATA_INDEX,\n      dataView: this._centerSeriesData.getDataView(),\n      dataProductId: this._centerSeriesData.getProductId()\n    }) as IRippleMark;\n    if (ripplePointMark) {\n      this._ripplePointMark = ripplePointMark;\n    }\n\n    const centerPointMark = this._createMark(CorrelationSeries.mark.centerPoint, {\n      key: DEFAULT_DATA_INDEX,\n      dataView: this._centerSeriesData.getDataView(),\n      dataProductId: this._centerSeriesData.getProductId(),\n      customShape: this._spec.centerPoint?.customShape\n    }) as ISymbolMark;\n    if (centerPointMark) {\n      centerPointMark.setZIndex(LayoutZIndex.Node);\n      this._centerPointMark = centerPointMark;\n    }\n  }\n\n  initMarkStyle(): void {\n    this._initNodePointMarkStyle();\n    this._initRipplePointMarkStyle();\n    this._initCenterPointMarkStyle();\n  }\n\n  protected _initNodePointMarkStyle() {\n    const nodePointMark = this._nodePointMark;\n    if (!nodePointMark) {\n      return;\n    }\n    const nodePointStyle = this._spec.nodePoint?.style ?? {};\n    this.setMarkStyle<ISymbolMarkSpec>(\n      nodePointMark,\n      {\n        x: (datum: Datum) => datum[CORRELATION_X],\n        y: (datum: Datum) => datum[CORRELATION_Y],\n        size: (datum: Datum) => datum[CORRELATION_SIZE],\n        fill: nodePointStyle.fill ?? this.getColorAttribute(),\n        fillOpacity: nodePointStyle.fillOpacity ?? 1,\n        lineWidth: 0\n      },\n      STATE_VALUE_ENUM.STATE_NORMAL,\n      AttributeLevel.Series\n    );\n\n    this._trigger.registerMark(nodePointMark);\n  }\n\n  protected _initRipplePointMarkStyle() {\n    const ripplePointMark = this._ripplePointMark;\n    if (!ripplePointMark) {\n      return;\n    }\n    const ripplePointStyle = this._spec.ripplePoint?.style ?? {};\n\n    this.setMarkStyle<IRippleMarkSpec>(\n      ripplePointMark,\n      {\n        x: () => {\n          return this._spec.centerX ?? (this._viewBox.x1 + this._viewBox.x2) / 2;\n        },\n        y: () => {\n          return this._spec.centerY ?? (this._viewBox.y1 + this._viewBox.y2) / 2;\n        },\n        size: () => {\n          return Math.max(this._viewBox.x2 - this._viewBox.x1, this._viewBox.y2 - this._viewBox.y1) / 2;\n        },\n        fill: ripplePointStyle.fill ?? this.getColorAttribute(),\n        opacity: ripplePointStyle.fillOpacity ?? 0.2,\n        ripple: ripplePointStyle.ripple ?? 0\n      },\n      STATE_VALUE_ENUM.STATE_NORMAL,\n      AttributeLevel.Series\n    );\n  }\n\n  protected _initCenterPointMarkStyle() {\n    const centerPointMark = this._centerPointMark;\n    if (!centerPointMark) {\n      return;\n    }\n    this.setMarkStyle<ISymbolMarkSpec>(\n      centerPointMark,\n      {\n        x: () => {\n          return this._spec.centerX ?? (this._viewBox.x1 + this._viewBox.x2) / 2;\n        },\n        y: () => {\n          return this._spec.centerY ?? (this._viewBox.y1 + this._viewBox.y2) / 2;\n        },\n        size: () => {\n          return (0.2 * Math.max(this._viewBox.x2 - this._viewBox.x1, this._viewBox.y2 - this._viewBox.y1)) / 2;\n        },\n        fill: this._spec.centerPoint?.style?.fill ?? this.getColorAttribute(),\n        fillOpacity: this._spec.centerPoint?.style?.fillOpacity ?? 1\n      },\n      STATE_VALUE_ENUM.STATE_NORMAL,\n      AttributeLevel.Series\n    );\n\n    this._trigger.registerMark(centerPointMark);\n  }\n\n  protected initTooltip() {\n    super.initTooltip();\n\n    this._nodePointMark && this._tooltipHelper.activeTriggerSet.mark.add(this._nodePointMark);\n  }\n\n  initLabelMarkStyle(labelMark?: ILabelMark): void {\n    if (!labelMark) {\n      return;\n    }\n    this.setMarkStyle(\n      labelMark,\n      {\n        fill: this.getColorAttribute(),\n        text: (datum: Datum) => {\n          return datum[this._categoryField];\n        },\n        z: this.dataToPositionZ.bind(this)\n      },\n      STATE_VALUE_ENUM.STATE_NORMAL,\n      AttributeLevel.Series\n    );\n  }\n\n  initAnimation() {\n    const appearPreset = (this._spec.animationAppear as IStateAnimateSpec<CorrelationAppearPreset>)?.preset;\n\n    this._nodePointMark.setAnimationConfig(\n      animationConfig(\n        Factory.getAnimationInKey('correlation')?.({}, appearPreset),\n        userAnimationConfig(SeriesMarkNameEnum.nodePoint, this._spec, this._markAttributeContext)\n      )\n    );\n  }\n\n  getGroupFields(): string[] {\n    return [];\n  }\n  getStackGroupFields(): string[] {\n    return [];\n  }\n  getStackValueField(): string {\n    return '';\n  }\n  getActiveMarks(): IMark[] {\n    return [this._nodePointMark, this._centerPointMark];\n  }\n\n  /** 获取维度field */\n  getDimensionField(): string[] {\n    return [this._categoryField];\n  }\n  /** 获取指标field */\n  getMeasureField(): string[] {\n    return [this._valueField];\n  }\n\n  onLayoutEnd(ctx: any): void {\n    super.onLayoutEnd(ctx);\n    this._viewBox.set(0, 0, this._region.getLayoutRect().width, this._region.getLayoutRect().height);\n    this._rawData.reRunAllTransform();\n    this.getViewData().reRunAllTransform();\n  }\n}\n\nexport const registerCorrelationSeries = () => {\n  registerSymbolMark();\n  registerRippleMark();\n  Factory.registerSeries(CorrelationSeries.type, CorrelationSeries);\n  registerCorrelationAnimation();\n};\n"]}