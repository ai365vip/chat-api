{"version":3,"sources":["../src/series/word-cloud/word-cloud-3d.ts"],"names":[],"mappings":"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","file":"word-cloud-3d.js","sourcesContent":["import { AttributeLevel } from '../../constant';\nimport { type ITextMark, registerTextMark } from '../../mark/text';\nimport { SeriesMarkNameEnum, SeriesTypeEnum } from '../interface/type';\nimport type { IWordCloud3dSeriesSpec } from './interface';\nimport type { Datum } from '../../typings';\nimport { animationConfig, userAnimationConfig } from '../../animation/utils';\nimport { BaseWordCloudSeries } from './base';\nimport { Factory } from '../../core/factory';\nimport { registerWordCloud3dAnimation } from './animation';\nimport { registerWordCloudTransforms } from '@visactor/vgrammar-wordcloud';\nimport { registerWordCloudShapeTransforms } from '@visactor/vgrammar-wordcloud-shape';\n\nexport class WordCloud3dSeries<\n  T extends IWordCloud3dSeriesSpec = IWordCloud3dSeriesSpec\n> extends BaseWordCloudSeries<T> {\n  static readonly type: string = SeriesTypeEnum.wordCloud3d;\n  type = SeriesTypeEnum.wordCloud3d;\n\n  protected _wordCloudTransformOption() {\n    return {\n      ...super._wordCloudTransformOption(),\n      postProjection: this._spec.postProjection ?? 'StereographicProjection',\n      depth_3d: this._spec.depth_3d\n    };\n  }\n\n  protected _wordCloudShapeTransformOption() {\n    return {\n      ...super._wordCloudShapeTransformOption(),\n      postProjection: this._spec.postProjection ?? 'StereographicProjection',\n      depth_3d: this._spec.depth_3d\n    };\n  }\n\n  initMark(): void {\n    this._wordMark = this._createMark(BaseWordCloudSeries.mark.word, {\n      groupKey: this._seriesField,\n      support3d: true,\n      isSeriesMark: true\n    }) as ITextMark;\n    if (this._isWordCloudShape) {\n      this._fillingWordMark = this._createMark(BaseWordCloudSeries.mark.fillingWord, {\n        groupKey: this._seriesField,\n        support3d: true,\n        isSeriesMark: true\n      }) as ITextMark;\n    }\n  }\n\n  initMarkStyle() {\n    super.initMarkStyle();\n    const wordMark = this._wordMark;\n    const fillingWordMark = this._fillingWordMark;\n    if (wordMark) {\n      this.setMarkStyle(\n        wordMark,\n        {\n          z: (datum: Datum) => datum.z ?? 0\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n    }\n    if (fillingWordMark) {\n      this.setMarkStyle(\n        fillingWordMark,\n        {\n          z: (datum: Datum) => datum.z ?? 0\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n    }\n  }\n\n  initAnimation() {\n    const padding = this._padding ?? {};\n    if (this._wordMark) {\n      this._wordMark.setAnimationConfig(\n        animationConfig(\n          Factory.getAnimationInKey('wordCloud3d')?.(() => {\n            const srView = this.getCompiler().getVGrammarView();\n            const width = srView.width() - padding.left || 0 - padding.right || 0;\n            const height = srView.height() - padding.top || 0 - padding.bottom || 0;\n            const r = Math.max(width, height) / 2;\n            return {\n              center: { x: r, y: r, z: this._spec.depth_3d ?? r },\n              r\n            };\n          }),\n          userAnimationConfig(SeriesMarkNameEnum.word, this._spec, this._markAttributeContext)\n        )\n      );\n    }\n    if (this._fillingWordMark) {\n      this._fillingWordMark.setAnimationConfig(\n        animationConfig(\n          Factory.getAnimationInKey('wordCloud3d')?.(() => {\n            const srView = this.getCompiler().getVGrammarView();\n            const width = srView.width() - padding.left || 0 - padding.right || 0;\n            const height = srView.height() - padding.top || 0 - padding.bottom || 0;\n            const r = Math.max(width, height) / 2;\n            return {\n              center: { x: r, y: r, z: this._spec.depth_3d ?? r },\n              r\n            };\n          }),\n          userAnimationConfig(SeriesMarkNameEnum.fillingWord, this._spec, this._markAttributeContext)\n        )\n      );\n    }\n  }\n}\n\nexport const registerWordCloud3dSeries = () => {\n  registerWordCloudTransforms();\n  registerTextMark();\n  registerWordCloud3dAnimation();\n  Factory.registerSeries(WordCloud3dSeries.type, WordCloud3dSeries);\n};\n\nexport const registerWordCloudShape3dSeries = () => {\n  registerWordCloudShapeTransforms();\n  registerWordCloud3dSeries();\n};\n"]}