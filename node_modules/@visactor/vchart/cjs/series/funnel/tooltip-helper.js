"use strict";

Object.defineProperty(exports, "__esModule", {
    value: !0
}), exports.FunnelSeriesTooltipHelper = void 0;

const type_1 = require("../interface/type"), tooltip_helper_1 = require("../base/tooltip-helper"), funnel_1 = require("../../constant/funnel"), vutils_1 = require("@visactor/vutils");

class FunnelSeriesTooltipHelper extends tooltip_helper_1.BaseSeriesTooltipHelper {
    constructor() {
        super(...arguments), this.titleValueCallback = (datum, params) => {
            var _a, _b, _c;
            const series = this.series;
            return (null === (_a = null == params ? void 0 : params.mark) || void 0 === _a ? void 0 : _a.name) === type_1.SeriesMarkNameEnum.transform ? "转化率" : null !== (_b = this._getDimensionData(datum)) && void 0 !== _b ? _b : null === (_c = datum.properties) || void 0 === _c ? void 0 : _c[`${series.getCategoryField()}`];
        }, this.contentValueCallback = (datum, params) => {
            var _a;
            if ((null === (_a = null == params ? void 0 : params.mark) || void 0 === _a ? void 0 : _a.name) === type_1.SeriesMarkNameEnum.transform) {
                return `${(100 * (null == datum ? void 0 : datum[funnel_1.FUNNEL_REACH_RATIO])).toFixed(1)}%`;
            }
            return this._getMeasureData(datum);
        }, this.contentKeyCallback = (datum, params) => {
            var _a;
            if ((null === (_a = null == params ? void 0 : params.mark) || void 0 === _a ? void 0 : _a.name) === type_1.SeriesMarkNameEnum.transform) return "转化率";
            const {dimensionFields: dimensionFields, seriesFields: seriesFields} = this._seriesCacheInfo, subDimensionField = dimensionFields[dimensionFields.length - 1];
            return (0, vutils_1.isValid)(seriesFields[0]) ? null == datum ? void 0 : datum[seriesFields[0]] : null == datum ? void 0 : datum[subDimensionField];
        };
    }
}

exports.FunnelSeriesTooltipHelper = FunnelSeriesTooltipHelper;
//# sourceMappingURL=tooltip-helper.js.map
