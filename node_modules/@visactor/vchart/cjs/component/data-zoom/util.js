"use strict";

Object.defineProperty(exports, "__esModule", {
    value: !0
}), exports.getDataFilterTheme = exports.dataFilterComputeDomain = exports.dataFilterWithNewDomain = void 0;

const typings_1 = require("../../typings"), util_1 = require("../../util"), util_2 = require("../util"), util_3 = require("../axis/cartesian/util"), dataFilterWithNewDomain = (data, op) => {
    const {getNewDomain: getNewDomain, isContinuous: isContinuous, field: field} = op, datumField = field(), newDomain = getNewDomain();
    if ((0, util_1.isNil)(newDomain) || (0, util_1.isNil)(datumField)) return data;
    if (0 === newDomain.length) return [];
    let filter = null;
    return filter = isContinuous() ? d => d[datumField] >= newDomain[0] && d[datumField] <= newDomain[1] : d => newDomain.indexOf(d[datumField] + "") >= 0 || newDomain.indexOf(d[datumField]) >= 0, 
    data.filter(filter);
};

exports.dataFilterWithNewDomain = dataFilterWithNewDomain;

const dataFilterComputeDomain = (data, op) => {
    const {stateFields: stateFields, valueFields: valueFields, dataCollection: dataCollection} = op.input, {stateField: stateField, valueField: valueField} = op.output, resultObj = {}, resultData = [];
    return dataCollection.forEach(((dv, i) => {
        var _a;
        if ((0, util_1.isNil)(stateFields[i])) return;
        const stateFieldInfo = null === (_a = dv.getFields()) || void 0 === _a ? void 0 : _a[stateFields[i]];
        stateFieldInfo && stateFieldInfo.lockStatisticsByDomain && stateFieldInfo.domain.forEach((d => {
            resultObj[d] = 0;
        })), dv.latestData.forEach((d => {
            (0, util_1.array)(stateFields[i]).forEach((state => {
                (0, util_1.isNil)(d[state]) || ((0, util_1.isNil)(resultObj[d[state]]) && (resultObj[d[state]] = 0), 
                (0, util_1.isNil)(valueFields[i]) || (resultObj[d[state]] += isNaN(parseFloat(d[valueFields[i]])) ? 1 : parseFloat(d[valueFields[i]])));
            }));
        }));
    })), Object.keys(resultObj).forEach(((d, i) => {
        const res = {
            [stateField]: d
        };
        valueField && (res[valueField] = resultObj[d]), resultData.push(res);
    })), resultData;
};

exports.dataFilterComputeDomain = dataFilterComputeDomain;

const getDataFilterTheme = (orient, type, chartTheme) => {
    const theme = (0, util_2.getComponentThemeFromOption)(type, chartTheme), directionTheme = theme[(0, 
    util_3.getDirectionByOrient)(orient)], finalTheme = (0, util_1.mergeSpec)({}, theme, directionTheme);
    return delete finalTheme[typings_1.Direction.horizontal], delete finalTheme[typings_1.Direction.vertical], 
    finalTheme;
};

exports.getDataFilterTheme = getDataFilterTheme;
//# sourceMappingURL=util.js.map
