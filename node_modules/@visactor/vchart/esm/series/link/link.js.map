{"version":3,"sources":["../src/series/link/link.ts"],"names":[],"mappings":"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","file":"link.js","sourcesContent":["/* eslint-disable no-duplicate-imports */\nimport { AttributeLevel, DEFAULT_DATA_SERIES_FIELD } from '../../constant/index';\nimport { CartesianSeries } from '../cartesian/cartesian';\nimport type { Maybe, Datum } from '../../typings';\nimport { isValid } from '@visactor/vutils';\nimport type { IRuleMark } from '../../mark/rule';\nimport type { IMark } from '../../mark/interface';\nimport { SeriesTypeEnum } from '../interface/type';\nimport { registerDataSetInstanceTransform } from '../../data/register';\nimport { ShapeTypeEnum } from '../../typings/shape';\nimport type { ISymbolMark } from '../../mark/symbol';\nimport type { IDotSeriesSpec } from '../dot/interface';\nimport type { IGroupMark } from '../../mark/group';\nimport { LinkSeriesTooltipHelper } from './tooltip-helper';\nimport type { ILinkSeriesSpec, ILinkSeriesTheme } from './interface';\nimport type { SeriesMarkMap } from '../interface';\nimport { RuleMark, registerRuleMark } from '../../mark/rule';\nimport { SymbolMark, registerSymbolMark } from '../../mark/symbol';\nimport { linkSeriesMark } from './constant';\nimport { linkDotInfo } from '../../data/transforms/link-dot-info';\nimport { Factory } from '../../core/factory';\nimport { TransformLevel } from '../../data/initialize';\n\nexport class LinkSeries<T extends ILinkSeriesSpec = ILinkSeriesSpec> extends CartesianSeries<T> {\n  static readonly type: string = SeriesTypeEnum.link;\n  type = SeriesTypeEnum.link;\n\n  static readonly mark: SeriesMarkMap = linkSeriesMark;\n\n  protected _fromField?: string;\n  getFromField() {\n    return this._fromField;\n  }\n  setFromField(field: string) {\n    if (isValid(field)) {\n      this._fromField = field;\n    }\n  }\n\n  protected _toField?: string;\n  getToField() {\n    return this._toField;\n  }\n  setToField(field: string) {\n    if (isValid(field)) {\n      this._toField = field;\n    }\n  }\n\n  protected _dotTypeField?: string;\n  getDotTypeField() {\n    return this._dotTypeField;\n  }\n  setDotTypeField(field: string) {\n    if (isValid(field)) {\n      this._dotTypeField = field;\n    }\n  }\n\n  protected _dotSeriesSpec?: IDotSeriesSpec;\n  getDotSeriesSpec() {\n    return this._dotSeriesSpec;\n  }\n  setDotSeriesSpec(spec: IDotSeriesSpec) {\n    if (isValid(spec)) {\n      this._dotSeriesSpec = spec;\n    }\n  }\n\n  protected _getDotData() {\n    const dotSeries = this._option.getChart().getSeriesInIndex([this._spec.dotSeriesIndex])[0];\n    if (!dotSeries) {\n      return [];\n    }\n    return dotSeries.getRawData().latestData;\n  }\n\n  initData() {\n    super.initData();\n\n    registerDataSetInstanceTransform(this._option.dataSet, 'linkDotInfo', linkDotInfo);\n    this.getViewData()?.transform(\n      {\n        type: 'linkDotInfo',\n        options: {\n          infoKey: 'dots',\n          fields: () => {\n            return {\n              fromField: this._fromField,\n              toField: this._toField,\n              xField: this._dotSeriesSpec.xField,\n              yField: this._dotSeriesSpec.yField\n            };\n          },\n          linkData: () => this._rawData.latestData,\n          dotData: () => this._getDotData()\n        },\n        level: TransformLevel.linkDotInfo\n      },\n      false\n    );\n  }\n\n  /**\n   * @override\n   */\n  setAttrFromSpec() {\n    super.setAttrFromSpec();\n    this.setFromField(this._spec.fromField);\n    this.setToField(this._spec.toField);\n    this.setDotTypeField(this._spec.dotTypeField);\n    this.setDotSeriesSpec(this._spec.dotSeriesSpec);\n  }\n\n  private _clipMark: IGroupMark;\n  private _containerMark: IGroupMark;\n  private _linkMark: IRuleMark;\n  private _arrowMark: ISymbolMark;\n  initMark(): void {\n    this._clipMark = this._createMark(LinkSeries.mark.group) as IGroupMark;\n\n    this._containerMark = this._createMark(LinkSeries.mark.group, {\n      parent: this._clipMark\n    }) as IGroupMark;\n\n    this._linkMark = this._createMark(LinkSeries.mark.link, {\n      skipBeforeLayouted: false,\n      parent: this._containerMark\n    }) as IRuleMark;\n\n    this._arrowMark = this._createMark(LinkSeries.mark.arrow, {\n      skipBeforeLayouted: false,\n      isSeriesMark: true,\n      parent: this._containerMark\n    }) as ISymbolMark;\n  }\n\n  initMarkStyle(): void {\n    const clipMark = this._clipMark;\n    if (clipMark) {\n      this.setMarkStyle(\n        clipMark,\n        {\n          x: -this._spec.leftAppendPadding,\n          y: 0,\n          // 本应使用this.getLayoutRect().width, 但这该返回值为0。考虑到横向不需要裁剪，故先采用一个较大值\n          width: 10000,\n          height: this._spec.clipHeight,\n          clip: true\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n      clipMark.setInteractive(false);\n    }\n\n    const containerMark = this._containerMark;\n    if (containerMark) {\n      this.setMarkStyle(\n        containerMark,\n        {\n          x: this._spec.leftAppendPadding,\n          width: this.getLayoutRect().width\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n      containerMark.setInteractive(false);\n    }\n\n    const linkMark = this._linkMark;\n    if (linkMark) {\n      this.setMarkStyle(\n        linkMark,\n        {\n          stroke: this.getColorAttribute(),\n          strokeOpacity: this.dataToOpacity.bind(this),\n          x: this.dataToPositionXFrom.bind(this),\n          y: this.dataToPositionYFrom.bind(this),\n          x1: this.dataToPositionXTo.bind(this),\n          y1: this.dataToPositionYTo.bind(this)\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n      this._trigger.registerMark(linkMark);\n    }\n\n    const arrowMark = this._arrowMark;\n    if (arrowMark) {\n      const arrowSize = (this._theme?.arrow?.style?.size as number) ?? 10;\n      this.setMarkStyle(\n        arrowMark,\n        {\n          x: this.dataToPositionXTo.bind(this),\n          y: (datum: Datum) => this.dataToPositionArrowYTo(datum, arrowSize), // csj-to do：箭头的dy不生效，暂时改变y position逻辑\n          fill: this.getColorAttribute(),\n          fillOpacity: this.dataToOpacity.bind(this),\n          size: arrowSize,\n          symbolType: (datum: Datum) => {\n            return this.isPositionYFromHigher(datum) ? ShapeTypeEnum.triangleDown : ShapeTypeEnum.triangleUp;\n          }\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n      this._trigger.registerMark(arrowMark);\n    }\n  }\n\n  afterInitMark(): void {\n    super.afterInitMark();\n    this._trigger.setStateKeys([this._seriesField as string, this._fromField]);\n  }\n\n  /** 以下函数用于定位link和arrow */\n\n  dataToPositionXFrom(datum: Datum): number {\n    if (!this._xAxisHelper) {\n      return Number.NaN;\n    }\n    const { dataToPosition } = this._xAxisHelper;\n\n    return dataToPosition(this.getDatumPositionValues(datum, this._fromField + '_xField'), {\n      bandPosition: this._bandPosition\n    });\n  }\n\n  dataToPositionYFrom(datum: Datum): number {\n    if (!this._yAxisHelper) {\n      return Number.NaN;\n    }\n    const { dataToPosition } = this._yAxisHelper;\n\n    return dataToPosition(this.getDatumPositionValues(datum, this._fromField + '_yField'));\n  }\n\n  dataToPositionXTo(datum: Datum): number {\n    if (!this._xAxisHelper) {\n      return Number.NaN;\n    }\n    const { dataToPosition } = this._xAxisHelper;\n    return dataToPosition(this.getDatumPositionValues(datum, this._toField + '_xField'), {\n      bandPosition: this._bandPosition\n    });\n  }\n\n  dataToPositionYTo(datum: Datum): number {\n    if (!this._yAxisHelper) {\n      return Number.NaN;\n    }\n    const { dataToPosition } = this._yAxisHelper;\n\n    return dataToPosition(this.getDatumPositionValues(datum, this._toField + '_yField'), {\n      bandPosition: this._bandPosition\n    });\n  }\n\n  dataToPositionArrowYTo(datum: Datum, arrowSize: number): number {\n    if (!this._yAxisHelper) {\n      return Number.NaN;\n    }\n    const { dataToPosition } = this._yAxisHelper;\n    const offset = this.isPositionYFromHigher(datum) ? -arrowSize / 2 : arrowSize / 2;\n    return (\n      dataToPosition(this.getDatumPositionValues(datum, this._toField + '_yField'), {\n        bandPosition: this._bandPosition\n      }) + offset\n    );\n  }\n\n  dataToOpacity(datum: Datum): number {\n    if (\n      this.isPositionXOuterRange(datum, this._fromField + '_xField') ||\n      this.isPositionXOuterRange(datum, this._toField + '_xField') ||\n      datum[this._fromField] === datum[this._toField]\n    ) {\n      return 0;\n    }\n    return 1;\n  }\n\n  /**\n   * @description 用于判断link的箭头方向\n   */\n  isPositionYFromHigher(datum: Datum): boolean {\n    return this.dataToPositionYFrom(datum) < this.dataToPositionYTo(datum);\n  }\n\n  /**\n   * @description 用于判断link的起点、终点坐标是否超出range范围\n   */\n  isPositionXOuterRange(datum: Datum, field: string): boolean {\n    if (!this._xAxisHelper) {\n      return false;\n    }\n    const { dataToPosition, getScale } = this._xAxisHelper;\n\n    if (\n      dataToPosition(this.getDatumPositionValues(datum, field), {\n        bandPosition: this._bandPosition\n      }) < getScale(0).range()[0] ||\n      dataToPosition(this.getDatumPositionValues(datum, field), {\n        bandPosition: this._bandPosition\n      }) > getScale(0).range()[1]\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @override\n   * @description 如果用户设置了dotType，则seriesGroup作为颜色映射字段\n   */\n  getDefaultColorDomain() {\n    return this._dotTypeField\n      ? this.getViewDataStatistics()?.latestData[this._dotTypeField].values\n      : this._seriesField\n      ? this.getViewDataStatistics()?.latestData[this._seriesField].values\n      : [];\n  }\n\n  /**\n   * @override\n   */\n  // 通用的默认颜色映射 用户设置优先级比这个高，会在setStyle中处理\n  getColorAttribute() {\n    return {\n      scale: this._option.globalScale.getScale('color') ?? this._getDefaultColorScale(),\n      field: this._dotTypeField ?? this._seriesField ?? DEFAULT_DATA_SERIES_FIELD\n    };\n  }\n\n  protected initTooltip() {\n    this._tooltipHelper = new LinkSeriesTooltipHelper(this);\n    this._linkMark && this._tooltipHelper.activeTriggerSet.mark.add(this._linkMark);\n    this._arrowMark && this._tooltipHelper.activeTriggerSet.mark.add(this._arrowMark);\n  }\n\n  protected onMarkTreePositionUpdate(marks: IMark[]): void {\n    marks.forEach(m => {\n      if (m.type === 'group') {\n        this.onMarkTreePositionUpdate((m as IGroupMark).getMarks());\n      } else {\n        m.updateLayoutState();\n      }\n    });\n  }\n\n  getDotInfoData() {\n    return (this._linkMark ?? this._arrowMark)?.getData();\n  }\n\n  getActiveMarks(): IMark[] {\n    return [this._linkMark, this._arrowMark];\n  }\n}\n\nexport const registerLinkSeries = () => {\n  registerRuleMark();\n  registerSymbolMark();\n  Factory.registerSeries(LinkSeries.type, LinkSeries);\n};\n"]}