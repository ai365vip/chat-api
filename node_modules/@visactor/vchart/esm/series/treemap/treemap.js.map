{"version":3,"sources":["../src/series/treemap/treemap.ts"],"names":[],"mappings":"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","file":"treemap.js","sourcesContent":["/* eslint-disable no-duplicate-imports */\nimport { STATE_VALUE_ENUM } from '../../compile/mark/interface';\nimport { AttributeLevel, DEFAULT_DATA_KEY, VGRAMMAR_HOOK_EVENT } from '../../constant';\nimport type { IMark } from '../../mark/interface';\nimport { MarkTypeEnum } from '../../mark/interface/type';\nimport type { IRectMark } from '../../mark/rect';\nimport type { Datum, IRectMarkSpec, ITextMarkSpec } from '../../typings';\nimport { CartesianSeries } from '../cartesian/cartesian';\nimport type { SeriesMarkMap } from '../interface';\nimport { SeriesTypeEnum } from '../interface/type';\nimport type { ITreemapSeriesSpec } from './interface';\nimport { registerDataSetInstanceTransform } from '../../data/register';\nimport type { ITreemapOpt } from '../../data/transforms/treemap';\nimport { treemap } from '../../data/transforms/treemap';\nimport { flatten } from '../../data/transforms/flatten';\nimport type { IBounds } from '@visactor/vutils';\nimport { isValidNumber, Bounds, Matrix, mixin } from '@visactor/vutils';\nimport type { PanEventParam, ZoomEventParam } from '../../event/interface';\nimport type { TreemapNodeElement } from '@visactor/vgrammar-hierarchy';\nimport { DataView } from '@visactor/vdataset';\nimport { hierarchyDimensionStatistics } from '../../data/transforms/hierarchy-dimension-statistics';\nimport { addVChartProperty } from '../../data/transforms/add-property';\nimport { addHierarchyDataKey, initHierarchyKeyMap } from '../../data/transforms/data-key';\nimport { DEFAULT_HIERARCHY_DEPTH, DEFAULT_HIERARCHY_ROOT } from '../../constant/hierarchy';\nimport { TreemapTooltipHelper } from './tooltip-helper';\nimport { animationConfig, userAnimationConfig } from '../../animation/utils';\nimport { registerFadeInOutAnimation } from '../../animation/config';\nimport type { TransformSpec } from '@visactor/vgrammar-core';\nimport type { IZoomable } from '../../interaction/zoom/zoomable';\nimport { Zoomable } from '../../interaction/zoom/zoomable';\nimport type { IDrillable } from '../../interaction/drill/drillable';\nimport { Drillable } from '../../interaction/drill/drillable';\nimport { registerRectMark } from '../../mark/rect';\nimport { registerTextMark } from '../../mark/text';\nimport { treemapSeriesMark } from './constant';\nimport { Factory } from '../../core/factory';\nimport { registerTreemapAnimation } from './animation';\nimport { TransformLevel } from '../../data/initialize';\nimport type { ILabelMark } from '../../mark/label';\nimport { TreemapSeriesSpecTransformer } from './treemap-transform';\n\nexport class TreemapSeries extends CartesianSeries<any> {\n  static readonly type: string = SeriesTypeEnum.treemap;\n  type = SeriesTypeEnum.treemap;\n\n  static readonly mark: SeriesMarkMap = treemapSeriesMark;\n\n  static readonly transformerConstructor = TreemapSeriesSpecTransformer;\n  readonly transformerConstructor = TreemapSeriesSpecTransformer;\n\n  private _leafMark: IRectMark;\n  private _nonLeafMark: IRectMark;\n  private _labelMark: ILabelMark;\n  private _nonLeafLabelMark: ILabelMark;\n\n  protected declare _spec: ITreemapSeriesSpec;\n\n  protected _categoryField!: string;\n  getCategoryField() {\n    return this._categoryField;\n  }\n  setCategoryField(f: string): string {\n    this._categoryField = f;\n    return this._categoryField;\n  }\n\n  protected _valueField!: string;\n  getValueField() {\n    return this._valueField;\n  }\n  setValueField(f: string): string {\n    this._valueField = f;\n    return this._valueField;\n  }\n\n  private _maxDepth: number;\n\n  // global scale and translate matrix\n  private _matrix: Matrix;\n\n  // range for treemap layout, change while zoom and pan\n  private _viewBox: IBounds = new Bounds();\n\n  private _enableAnimationHook = this.enableMarkAnimation.bind(this);\n\n  setAttrFromSpec(): void {\n    super.setAttrFromSpec();\n    this.setCategoryField(this._spec.categoryField);\n    this.setValueField(this._spec.valueField);\n    this.setSeriesField(this._spec.seriesField ?? DEFAULT_HIERARCHY_ROOT);\n\n    if (this._spec.roam) {\n      (this as unknown as IZoomable).initZoomable(this.event, this._option.mode);\n      this._matrix = new Matrix();\n    }\n    if (this._spec.drill) {\n      (this as unknown as IDrillable).initDrillable({\n        event: this.event,\n        mode: this._option.mode,\n        drillField: () => this._spec.drillField ?? DEFAULT_DATA_KEY,\n        getRawData: () => this.getRawData()\n      });\n    }\n\n    if (isValidNumber(this._spec.maxDepth)) {\n      this._maxDepth = this._spec.maxDepth - 1;\n    }\n  }\n\n  initData() {\n    super.initData();\n    // 矩形树图中原始数据为层次结果，图元数据为平坦化后的结构，具体逻辑如下：\n    // spec.data => rawData(hierarchy) => viewDataFilter => treemap transform => flatten transform => viewData\n    if (this.getViewData()) {\n      // 对原始数据进行上卷下钻筛选\n      if (this._spec.drill) {\n        (this as unknown as IDrillable).initDrillableData(this._dataSet);\n      }\n\n      registerDataSetInstanceTransform(this._dataSet, 'treemap', treemap);\n      registerDataSetInstanceTransform(this._dataSet, 'flatten', flatten);\n\n      this.addViewDataFilter({\n        type: 'treemap',\n        options: {\n          range: () => {\n            return {\n              x0: this._viewBox.x1,\n              x1: this._viewBox.x2,\n              y0: this._viewBox.y1,\n              y1: this._viewBox.y2\n            };\n          },\n          maxDepth: this._maxDepth,\n          gapWidth: this._spec.gapWidth,\n          padding: this._spec.nodePadding,\n          splitType: this._spec.splitType,\n          aspectRatio: this._spec.aspectRatio,\n          labelPadding: this._spec.nonLeafLabel?.visible ? this._spec.nonLeafLabel?.padding : 0,\n          labelPosition: this._spec.nonLeafLabel?.position,\n          minVisibleArea: this._spec.minVisibleArea ?? 10,\n          minChildrenVisibleArea: this._spec.minChildrenVisibleArea,\n          minChildrenVisibleSize: this._spec.minChildrenVisibleSize\n        } as ITreemapOpt,\n        level: TransformLevel.treemapFilter\n      });\n\n      this.addViewDataFilter({\n        type: 'flatten',\n        options: {\n          callback: (node: TreemapNodeElement) => {\n            if (node.datum) {\n              const nodeData = node.datum[node.depth];\n              return { ...node, ...nodeData };\n            }\n            return node;\n          }\n        },\n        level: TransformLevel.treemapFlatten\n      });\n    }\n  }\n\n  protected _addDataIndexAndKey() {\n    if (this._rawData?.dataSet) {\n      registerDataSetInstanceTransform(this._rawData.dataSet, 'addVChartProperty', addVChartProperty);\n      this._rawData.transform(\n        {\n          type: 'addVChartProperty',\n          options: {\n            beforeCall: initHierarchyKeyMap.bind(this),\n            call: addHierarchyDataKey\n          }\n        }\n        // rawDataStatistic 需要统计 addHierarchyDataKey 的一些字段，所以必须要运行一下\n        // false\n      );\n    }\n  }\n\n  getRawDataStatisticsByField(field: string, isNumeric?: boolean) {\n    if (!this._rawDataStatistics) {\n      const rawDataName = `${this.type}_${this.id}_rawDataStatic`;\n      this._rawDataStatistics = this._createHierarchyDataStatistics(rawDataName, [this._rawData]);\n      this._rawData.target.removeListener('change', this._rawDataStatistics.reRunAllTransform);\n      this._rawDataStatistics.reRunAllTransform();\n    }\n\n    return this._rawDataStatistics.latestData?.[field];\n  }\n\n  protected _createHierarchyDataStatistics(dataName: string, rawData: DataView[]) {\n    registerDataSetInstanceTransform(this._dataSet, 'hierarchyDimensionStatistics', hierarchyDimensionStatistics);\n    registerDataSetInstanceTransform(this._dataSet, 'flatten', flatten);\n    const data = new DataView(this._dataSet, { name: dataName });\n    data.parse(rawData, {\n      type: 'dataview'\n    });\n    data.transform(\n      {\n        type: 'hierarchyDimensionStatistics',\n        options: {\n          fields: () => {\n            const fields = this.getStatisticFields();\n            if (this._seriesField && this._seriesField !== this._categoryField) {\n              fields.push({\n                key: this._seriesField,\n                operations: ['values']\n              });\n            }\n            return fields;\n          }\n        }\n      },\n      false\n    );\n    return data;\n  }\n\n  getStatisticFields() {\n    const fields = super.getStatisticFields();\n    return fields.concat([\n      {\n        key: this._categoryField,\n        operations: ['values']\n      },\n      {\n        key: this._valueField,\n        operations: ['max', 'min']\n      },\n      {\n        key: DEFAULT_HIERARCHY_DEPTH,\n        operations: ['max', 'min', 'values']\n      },\n      {\n        key: DEFAULT_HIERARCHY_ROOT,\n        operations: ['values']\n      }\n    ]);\n  }\n\n  initMark() {\n    const nonLeafMark = this._createMark(TreemapSeries.mark.nonLeaf, {\n      isSeriesMark: true,\n      customShape: this._spec.nonLeaf?.customShape\n    });\n    if (nonLeafMark) {\n      nonLeafMark.setTransform([\n        {\n          type: 'filter',\n          callback: (datum: TreemapNodeElement) => {\n            return !this._shouldFilterElement(datum, 'nonLeaf');\n          }\n        } as TransformSpec\n      ]);\n      this._trigger.registerMark(nonLeafMark);\n      this._nonLeafMark = nonLeafMark;\n    }\n\n    const leafMark = this._createMark(TreemapSeries.mark.leaf, {\n      isSeriesMark: true,\n      customShape: this._spec.leaf?.customShape\n    });\n    if (leafMark) {\n      leafMark.setTransform([\n        {\n          type: 'filter',\n          callback: (datum: TreemapNodeElement) => {\n            return !this._shouldFilterElement(datum, 'leaf');\n          }\n        } as TransformSpec\n      ]);\n      this._leafMark = leafMark;\n      this._trigger.registerMark(leafMark);\n    }\n  }\n\n  initMarkStyle() {\n    this._initLeafMarkStyle();\n    this._initNonLeafMarkStyle();\n  }\n\n  protected _initLeafMarkStyle() {\n    if (!this._leafMark) {\n      return;\n    }\n\n    this.setMarkStyle<IRectMarkSpec>(\n      this._leafMark,\n      {\n        x: datum => datum.x0,\n        y: datum => datum.y0,\n        x1: datum => datum.x1,\n        y1: datum => datum.y1,\n        fill: this.getColorAttribute()\n      },\n      STATE_VALUE_ENUM.STATE_NORMAL,\n      AttributeLevel.Series\n    );\n  }\n\n  protected _initNonLeafMarkStyle() {\n    if (!this._nonLeafMark) {\n      return;\n    }\n    this.setMarkStyle<IRectMarkSpec>(\n      this._nonLeafMark,\n      {\n        x: datum => datum.x0,\n        y: datum => datum.y0,\n        x1: datum => datum.x1,\n        y1: datum => datum.y1,\n        fill: this.getColorAttribute()\n      },\n      STATE_VALUE_ENUM.STATE_NORMAL,\n      AttributeLevel.Series\n    );\n  }\n\n  initLabelMarkStyle(labelMark: ILabelMark) {\n    if (!labelMark) {\n      return;\n    }\n    this._labelMark = labelMark;\n    labelMark.setRule('treemap');\n    this.setMarkStyle<ITextMarkSpec>(\n      labelMark,\n      {\n        x: datum => (datum.x0 + datum.x1) / 2,\n        y: datum => (datum.y0 + datum.y1) / 2,\n        text: datum => {\n          return datum.datum[datum.depth]?.[this.getDimensionField()[0]];\n        },\n        maxLineWidth: (datum: Datum) => {\n          return datum.x1 === datum.x0 ? Number.MIN_VALUE : datum.x1 - datum.x0;\n        }\n      },\n      STATE_VALUE_ENUM.STATE_NORMAL,\n      AttributeLevel.Series\n    );\n  }\n\n  protected initNonLeafLabelMarkStyle(labelMark: ILabelMark) {\n    if (!labelMark) {\n      return;\n    }\n    this._nonLeafLabelMark = labelMark;\n    labelMark.setRule('treemap');\n    this.setMarkStyle<ITextMarkSpec>(\n      labelMark,\n      {\n        x: datum => {\n          if (datum.labelRect) {\n            return (datum.labelRect.x0 + datum.labelRect.x1) / 2;\n          }\n          return (datum.x0 + datum.x1) / 2;\n        },\n        y: datum => {\n          if (datum.labelRect) {\n            return (datum.labelRect.y0 + datum.labelRect.y1) / 2;\n          }\n          return (datum.y0 + datum.y1) / 2;\n        },\n        text: datum => {\n          return datum.datum[datum.depth]?.[this.getDimensionField()[0]];\n        },\n        maxLineWidth: (datum: any) => {\n          return datum.x1 === datum.x0 ? Number.MIN_VALUE : datum.x1 - datum.x0;\n        }\n      },\n      STATE_VALUE_ENUM.STATE_NORMAL,\n      AttributeLevel.Series\n    );\n  }\n\n  initAnimation(): void {\n    this.getMarksInType(MarkTypeEnum.rect).forEach(mark => {\n      mark.setAnimationConfig(\n        animationConfig(\n          Factory.getAnimationInKey('treemap')?.(),\n          userAnimationConfig(mark.name, this._spec, this._markAttributeContext)\n        )\n      );\n    });\n\n    this.getMarksInType(MarkTypeEnum.text).forEach(mark => {\n      mark.setAnimationConfig(\n        animationConfig(\n          Factory.getAnimationInKey('fadeInOut')?.(),\n          userAnimationConfig(mark.name, this._spec, this._markAttributeContext)\n        )\n      );\n    });\n  }\n\n  protected initEvent(): void {\n    super.initEvent();\n    // Roam\n    if (this._spec.roam) {\n      // 拖拽事件\n      (this as unknown as IZoomable).initDragEventOfSeries(this);\n      this.event.on('panmove', e => {\n        this.handlePan(e as PanEventParam);\n      });\n      // 缩放事件\n      (this as unknown as IZoomable).initZoomEventOfSeries(this);\n      this.event.on('zoom', e => {\n        this.handleZoom(e as ZoomEventParam);\n      });\n    }\n    // Drill\n    if (this._spec.drill) {\n      (this as unknown as IDrillable).bindDrillEvent();\n    }\n  }\n\n  protected _getDataIdKey() {\n    return 'key';\n  }\n\n  protected initTooltip() {\n    this._tooltipHelper = new TreemapTooltipHelper(this);\n    this._leafMark && this._tooltipHelper.activeTriggerSet.mark.add(this._leafMark);\n    this._nonLeafMark && this._tooltipHelper.activeTriggerSet.mark.add(this._nonLeafMark);\n  }\n\n  private _shouldFilterElement(datum: TreemapNodeElement, nodeType: 'leaf' | 'nonLeaf') {\n    const isLeaf = datum.isLeaf;\n    // 过滤掉非需要的节点\n    return nodeType === 'leaf' ? !isLeaf : isLeaf;\n  }\n\n  handlePan(event: PanEventParam) {\n    const { delta } = event;\n    if (delta[0] === 0 && delta[1] === 0) {\n      return;\n    }\n    this._matrix.reset();\n    this._matrix.translate(delta[0], delta[1]);\n    const { a, b, c, d, e, f } = this._matrix;\n    this._matrix.multiply(a, b, c, d, e, f);\n\n    this._viewBox.transformWithMatrix(this._matrix);\n\n    this.reFilterViewData();\n  }\n\n  handleZoom(event: ZoomEventParam) {\n    const { scale, scaleCenter } = event;\n    if (scale === 1) {\n      return;\n    }\n\n    this._matrix.reset();\n    const { x, y } = scaleCenter;\n    this._matrix.translate(x, y);\n    this._matrix.scale(scale, scale);\n    this._matrix.translate(-x, -y);\n    const { a, b, c, d, e, f } = this._matrix;\n    this._matrix.multiply(a, b, c, d, e, f);\n    // 缩放过程中会有新增/减少的element，对应执行enter/exit动画，会使得缩放交互效果体验很差\n    // 这里在缩放过程中先关闭所有动画\n    this.disableMarkAnimation();\n    this.event.on(VGRAMMAR_HOOK_EVENT.AFTER_DO_RENDER, this._enableAnimationHook);\n    this._viewBox.transformWithMatrix(this._matrix);\n    this.reFilterViewData();\n  }\n\n  getDimensionField() {\n    return [this._categoryField];\n  }\n\n  getMeasureField(): string[] {\n    return [this._valueField];\n  }\n\n  onLayoutEnd(ctx: any): void {\n    super.onLayoutEnd(ctx);\n    this._viewBox.set(0, 0, this.getLayoutRect().width, this.getLayoutRect().height);\n    this._rawData.reRunAllTransform();\n  }\n\n  protected enableMarkAnimation() {\n    this.getMarks().forEach(mark => {\n      mark.getProduct().animate?.enable();\n    });\n    [this._labelMark, this._nonLeafLabelMark].forEach(m => {\n      if (m && m.getComponent()) {\n        m.getComponent().getProduct().getGroupGraphicItem().enableAnimation();\n      }\n    });\n    // 在所有动画执行之后关闭动画\n    this.event.off(VGRAMMAR_HOOK_EVENT.AFTER_DO_RENDER, this._enableAnimationHook);\n  }\n\n  protected disableMarkAnimation() {\n    this.getMarks().forEach(mark => {\n      mark.getProduct().animate?.disable();\n    });\n    [this._labelMark, this._nonLeafLabelMark].forEach(m => {\n      if (m && m.getComponent()) {\n        m.getComponent().getProduct().getGroupGraphicItem().disableAnimation();\n      }\n    });\n  }\n\n  getDefaultShapeType(): string {\n    return 'square';\n  }\n\n  getActiveMarks(): IMark[] {\n    return [this._nonLeafMark, this._leafMark];\n  }\n}\n\nmixin(TreemapSeries, Drillable);\nmixin(TreemapSeries, Zoomable);\n\nexport const registerTreemapSeries = () => {\n  registerRectMark();\n  registerTextMark();\n  registerTreemapAnimation();\n  registerFadeInOutAnimation();\n  Factory.registerSeries(TreemapSeries.type, TreemapSeries);\n};\n"]}