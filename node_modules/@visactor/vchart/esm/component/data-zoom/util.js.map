{"version":3,"sources":["../src/component/data-zoom/util.ts"],"names":[],"mappings":"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","file":"util.js","sourcesContent":["import type { IModelOption } from '../../model/interface';\nimport { Direction, type IOrientType } from '../../typings';\nimport { array, isNil, mergeSpec } from '../../util';\nimport type { DataView } from '@visactor/vdataset';\nimport type { ComponentTypeEnum } from '../interface';\nimport { getComponentThemeFromOption } from '../util';\nimport { getDirectionByOrient } from '../axis/cartesian/util';\nimport type { ITheme } from '../../theme';\n\nexport interface IDataFilterWithNewDomainOption {\n  getNewDomain: () => any[];\n  isContinuous: () => boolean;\n  field: () => string;\n}\n\n/**\n * 保证数据筛选的结果全都在坐标轴的新domain范围中，防止出现point数据因为超出domain范围而绘制在原点的情况\n */\nexport const dataFilterWithNewDomain = (data: Array<any>, op: IDataFilterWithNewDomainOption) => {\n  const { getNewDomain, isContinuous, field } = op;\n  const datumField = field();\n  const newDomain = getNewDomain();\n  if (isNil(newDomain) || isNil(datumField)) {\n    return data;\n  }\n  if (newDomain.length === 0) {\n    return [];\n  }\n\n  let filter = null;\n  if (isContinuous()) {\n    filter = (d: any) => d[datumField] >= newDomain[0] && d[datumField] <= newDomain[1];\n  } else {\n    filter = (d: any) => {\n      // 这里d[f] + ''的原因是：数据是number类型的，但轴声明为band轴，domain会强制将number => string，所以filter的时候要将data中的number => string\n      return newDomain.indexOf(d[datumField] + '') >= 0 || newDomain.indexOf(d[datumField]) >= 0;\n    };\n  }\n\n  return data.filter(filter);\n};\n\nexport interface IDataFilterComputeDomainOption {\n  input: {\n    dataCollection: any[];\n    stateFields: string[];\n    valueFields: string[];\n    method: 'sum'; // todo: 也许可以提供多种数据统计方法 @chensiji\n  };\n  output: {\n    stateField: string;\n    valueField: string;\n  };\n}\n\nexport const dataFilterComputeDomain = (data: Array<any>, op: IDataFilterComputeDomainOption) => {\n  const { stateFields, valueFields, dataCollection } = op.input;\n  const { stateField, valueField } = op.output;\n  const resultObj = {};\n  const resultData: any[] = [];\n\n  dataCollection.forEach((dv: DataView, i) => {\n    if (isNil(stateFields[i])) {\n      return;\n    }\n    // 按照用户指定的domain进行排序(这里不通过getRawDataStatistics来取是因为时机不对，此时getRawDataStatistics还没有正确结果)\n    const stateFieldInfo = dv.getFields()?.[stateFields[i]];\n    if (stateFieldInfo && stateFieldInfo.lockStatisticsByDomain) {\n      stateFieldInfo.domain.forEach((d: any) => {\n        resultObj[d] = 0;\n      });\n    }\n    dv.latestData.forEach((d: any) => {\n      // 针对rangeColumn等xField为数组形式的图表，需要将xField的所有value都记录下来\n      array(stateFields[i]).forEach(state => {\n        if (!isNil(d[state])) {\n          if (isNil(resultObj[d[state]])) {\n            resultObj[d[state]] = 0;\n          }\n          if (!isNil(valueFields[i])) {\n            // 传进来的d[yFields[i]]可能是stringnumber\n            // 传进来的d[yFields[i]]可能是普通的字符串，这时计数按1计算（其实相当于计算数据条数）\n            resultObj[d[state]] += isNaN(parseFloat(d[valueFields[i]])) ? 1 : parseFloat(d[valueFields[i]]);\n          }\n        }\n      });\n    });\n  });\n  Object.keys(resultObj).forEach((d, i) => {\n    const res = { [stateField]: d };\n\n    if (valueField) {\n      res[valueField] = resultObj[d];\n    }\n\n    resultData.push(res);\n  });\n\n  return resultData;\n};\n\nexport const getDataFilterTheme = (orient: IOrientType, type: ComponentTypeEnum, chartTheme: ITheme) => {\n  const theme = getComponentThemeFromOption(type, chartTheme);\n  const directionTheme = theme[getDirectionByOrient(orient)];\n  const finalTheme = mergeSpec({}, theme, directionTheme);\n\n  delete finalTheme[Direction.horizontal];\n  delete finalTheme[Direction.vertical];\n  return finalTheme;\n};\n"]}