import { Factory } from "./../core/factory";

import { isFunction, isValid } from "@visactor/vutils";

import { MarkTypeEnum } from "./interface/type";

import { BaseArcMark } from "./arc";

import { registerVGrammarArcAnimation } from "../animation/config";

import { registerArcGraphic } from "@visactor/vgrammar-core";

export class ProgressArcMark extends BaseArcMark {
    constructor() {
        super(...arguments), this._cacheStateStyle = {};
    }
    _getDefaultStyle() {
        return Object.assign(Object.assign({}, super._getDefaultStyle()), {
            innerPadding: 0,
            outerPadding: 0
        });
    }
    _filterStyle(style, state, level, stateStyle = this.stateStyle) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;
        isValid(style.innerRadius) && this.setAttribute("innerRadius", this._styleConvert(style.innerRadius), state, level, this._cacheStateStyle), 
        isValid(style.outerRadius) && this.setAttribute("outerRadius", this._styleConvert(style.outerRadius), state, level, this._cacheStateStyle);
        const innerPadding = null !== (_a = style.innerPadding) && void 0 !== _a ? _a : null === (_c = null === (_b = stateStyle[state]) || void 0 === _b ? void 0 : _b.innerPadding) || void 0 === _c ? void 0 : _c.style, outerPadding = null !== (_d = style.outerPadding) && void 0 !== _d ? _d : null === (_f = null === (_e = stateStyle[state]) || void 0 === _e ? void 0 : _e.outerPadding) || void 0 === _f ? void 0 : _f.style, innerRadius = null !== (_k = null !== (_g = style.innerRadius) && void 0 !== _g ? _g : null === (_j = null === (_h = this._cacheStateStyle[state]) || void 0 === _h ? void 0 : _h.innerRadius) || void 0 === _j ? void 0 : _j.style) && void 0 !== _k ? _k : null === (_m = null === (_l = stateStyle[state]) || void 0 === _l ? void 0 : _l.innerRadius) || void 0 === _m ? void 0 : _m.style, outerRadius = null !== (_r = null !== (_o = style.outerRadius) && void 0 !== _o ? _o : null === (_q = null === (_p = this._cacheStateStyle[state]) || void 0 === _p ? void 0 : _p.outerRadius) || void 0 === _q ? void 0 : _q.style) && void 0 !== _r ? _r : null === (_t = null === (_s = stateStyle[state]) || void 0 === _s ? void 0 : _s.outerRadius) || void 0 === _t ? void 0 : _t.style;
        if (0 === innerRadius && 0 === outerRadius) return style;
        const paddingModified = isValid(style.innerPadding) && isValid(innerRadius) || isValid(style.outerPadding) && isValid(outerRadius), radiusModified = isValid(style.innerRadius) && innerPadding || isValid(style.outerRadius) && outerPadding;
        if (paddingModified || radiusModified) {
            const newStyle = Object.assign({}, style);
            return innerPadding && isValid(innerRadius) && (isFunction(innerRadius) ? newStyle.innerRadius = (item, ctx, opt, source) => innerRadius(item, ctx, opt, source) + (isFunction(innerPadding) ? innerPadding(item, ctx, opt, source) : innerPadding) : isFunction(innerPadding) ? newStyle.innerRadius = (item, ctx, opt, source) => {
                const padding = innerPadding(item, ctx, opt, source);
                return innerRadius + padding;
            } : newStyle.innerRadius = innerRadius + innerPadding), outerPadding && isValid(outerRadius) && (isFunction(outerRadius) ? newStyle.outerRadius = (item, ctx, opt, source) => outerRadius(item, ctx, opt, source) - (isFunction(outerPadding) ? outerPadding(item, ctx, opt, source) : outerPadding) : isFunction(outerPadding) ? newStyle.outerRadius = (item, ctx, opt, source) => {
                const padding = outerPadding(item, ctx, opt, source);
                return outerRadius - padding;
            } : newStyle.outerRadius = outerRadius - outerPadding), newStyle;
        }
        return style;
    }
}

ProgressArcMark.type = MarkTypeEnum.arc, ProgressArcMark.constructorType = MarkTypeEnum.progressArc;

export const registerProgressArcMark = () => {
    registerArcGraphic(), registerVGrammarArcAnimation(), Factory.registerMark(ProgressArcMark.constructorType, ProgressArcMark);
};
//# sourceMappingURL=progress-arc.js.map
