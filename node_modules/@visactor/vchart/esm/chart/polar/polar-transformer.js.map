{"version":3,"sources":["../src/chart/polar/polar-transformer.ts"],"names":[],"mappings":"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","file":"polar-transformer.js","sourcesContent":["import { array, isArray, isNil, isValid } from '@visactor/vutils';\nimport type { IDataZoomSpec, IIndicatorSpec } from '../../component';\nimport { BaseChartSpecTransformer } from '../base';\nimport type { IPolarChartSpec } from './interface';\nimport { IFilterMode } from '../../component/data-zoom/constant';\nimport type { ISeriesSpec } from '../../typings';\n\nexport class PolarChartSpecTransformer<T extends IPolarChartSpec> extends BaseChartSpecTransformer<T> {\n  protected _isValidSeries(type: string): boolean {\n    return this.seriesType ? type === this.seriesType : true;\n  }\n\n  protected getIndicatorSpec(spec: any): IIndicatorSpec[] {\n    const indicatorSpec = array(spec.indicator) as IIndicatorSpec[];\n    const limitRatio = spec.innerRadius ?? spec.series?.[0]?.innerRadius;\n    if (isValid(limitRatio)) {\n      indicatorSpec.forEach(indicator => {\n        if (isNil(indicator.limitRatio)) {\n          indicator.limitRatio = limitRatio;\n        }\n      });\n    }\n    return indicatorSpec;\n  }\n\n  protected _getDefaultSeriesSpec(spec: any): any {\n    const series: any = {\n      ...super._getDefaultSeriesSpec(spec),\n\n      /**\n       * 旧的radius写法, 仅做兼容\n       * @deprecated use outerRadius instead\n       */\n      radius: spec.radius,\n      outerRadius: spec.outerRadius,\n      innerRadius: spec.innerRadius,\n\n      startAngle: spec.startAngle,\n      endAngle: spec.endAngle,\n      sortDataByAxis: spec.sortDataByAxis\n    };\n    const seriesType = this.seriesType;\n    if (seriesType) {\n      series.type = seriesType;\n      series[seriesType] = spec[seriesType];\n    }\n\n    return series;\n  }\n\n  transformSpec(spec: T): void {\n    super.transformSpec(spec);\n    /** 处理极坐标系下的 datazoom */\n    if (isArray(spec.dataZoom) && spec.dataZoom.length > 0) {\n      spec.dataZoom.forEach((zoom: IDataZoomSpec) => {\n        // 极坐标系下 datazoom 目前只支持数据过滤\n        // 理想效果：角度轴不支持 axis， 径向轴均支持（通过 group.clip 自定义 clipPath 支持）\n        if (zoom.filterMode === IFilterMode.axis) {\n          zoom.filterMode = IFilterMode.filter;\n        }\n      });\n    }\n    /* 处理 series 配置 */\n    const defaultSeriesSpec = this._getDefaultSeriesSpec(spec);\n    if (!spec.series || spec.series.length === 0) {\n      spec.series = [defaultSeriesSpec];\n    } else {\n      spec.series.forEach((s: ISeriesSpec) => {\n        if (!this._isValidSeries(s.type)) {\n          return;\n        }\n        Object.keys(defaultSeriesSpec).forEach(k => {\n          if (!(k in s)) {\n            s[k] = defaultSeriesSpec[k];\n          }\n        });\n      });\n    }\n\n    /* 处理 indicator 配置 */\n    if (isValid((spec as any).indicator)) {\n      (spec as any).indicator = this.getIndicatorSpec(spec);\n    }\n  }\n}\n"]}