{"version":3,"sources":["../src/data/transforms/hierarchy-dimension-statistics.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,kBAAkB,CAAC;AAC9C,OAAO,EAAE,mBAAmB,EAAE,MAAM,wBAAwB,CAAC;AAG7D,OAAO,EAAE,OAAO,EAAE,MAAM,WAAW,CAAC;AASpC,MAAM,CAAC,MAAM,4BAA4B,GAAG,CAAC,IAAqB,EAAE,EAAqB,EAAE,EAAE;IAC3F,IAAI,MAAM,GAAG,EAAE,CAAC;IAChB,IAAI,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC;IACvB,IAAI,UAAU,CAAC,MAAM,CAAC,EAAE;QACtB,MAAM,GAAG,MAAM,EAAE,CAAC;KACnB;IACD,IAAI,CAAC,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,MAAM,CAAA,IAAI,CAAC,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,MAAM,CAAA,EAAE;QACpC,OAAO,MAAM,CAAC;KACf;IAED,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,UAAU,EAAE;QACvB,OAAO,MAAM,CAAC;KACf;IAED,MAAM,aAAa,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,UAAqB,CAAC;IACpD,MAAM,QAAQ,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;IACxC,MAAM,GAAG,mBAAmB,CAAC,CAAC,EAAE,UAAU,EAAE,QAAQ,EAAS,CAAC,EAAE,EAAE,CAAC,CAAC;IACpE,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC","file":"hierarchy-dimension-statistics.js","sourcesContent":["import { isFunction } from '@visactor/vutils';\nimport { dimensionStatistics } from './dimension-statistics';\nimport type { IStatisticsOption } from './dimension-statistics';\nimport type { DataView } from '@visactor/vdataset';\nimport { flatten } from './flatten';\nimport type { Datum } from '../../typings';\n\n/**\n * 层次聚合统计主要用于处理层次数据(诸如统计平均值,求和等),并返回计算后的数据结果\n * @param data\n * @param options\n * @returns\n */\nexport const hierarchyDimensionStatistics = (data: Array<DataView>, op: IStatisticsOption) => {\n  let result = {};\n  let fields = op.fields;\n  if (isFunction(fields)) {\n    fields = fields();\n  }\n  if (!fields?.length || !data?.length) {\n    return result;\n  }\n\n  if (!data[0].latestData) {\n    return result;\n  }\n\n  const hierarchyData = data[0].latestData as Datum[];\n  const flatData = flatten(hierarchyData);\n  result = dimensionStatistics([{ latestData: flatData } as any], op);\n  return result;\n};\n"]}