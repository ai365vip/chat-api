{"version":3,"sources":["../src/render/contributions/rough/rough-arc.ts"],"names":[],"mappings":"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","file":"rough-arc.js","sourcesContent":["import type {\n  IGraphicRender,\n  IRenderService,\n  IArc,\n  IGraphicAttribute,\n  IContext2d,\n  IGraphic,\n  IMarkAttribute,\n  IThemeAttribute,\n  IDrawContext,\n  IGraphicRenderDrawParams\n} from '@visactor/vrender-core';\nimport {\n  ARC_NUMBER_TYPE,\n  DefaultCanvasArcRender,\n  getTheme,\n  CustomPath2D,\n  drawArcPath,\n  inject,\n  injectable\n} from '@visactor/vrender-core';\nimport rough from 'roughjs';\nimport { defaultRouthThemeSpec } from './config';\n\n@injectable()\nexport class RoughCanvasArcRender implements IGraphicRender {\n  type: 'arc';\n  numberType: number;\n  style: 'rough' = 'rough';\n\n  constructor(\n    @inject(DefaultCanvasArcRender)\n    public readonly canvasRenderer: IGraphicRender\n  ) {\n    this.type = 'arc';\n    this.numberType = ARC_NUMBER_TYPE;\n  }\n\n  draw(arc: IArc, renderService: IRenderService, drawContext: IDrawContext, params?: IGraphicRenderDrawParams) {\n    const { context } = drawContext;\n    if (!context) {\n      return;\n    }\n    // 获取到原生canvas\n    const canvas = context.canvas.nativeCanvas;\n    const rc = rough.canvas(canvas);\n\n    context.highPerformanceSave();\n\n    // const arcAttribute = graphicService.themeService.getCurrentTheme().arcAttribute;\n    const arcAttribute = getTheme(arc).arc;\n    let { x = arcAttribute.x, y = arcAttribute.y } = arc.attribute;\n    if (!arc.transMatrix.onlyTranslate()) {\n      // 性能较差\n      x = 0;\n      y = 0;\n      context.transformFromMatrix(arc.transMatrix, true);\n    } else {\n      const { dx = arcAttribute.dx, dy = arcAttribute.dy } = arc.attribute;\n      x += dx;\n      y += dy;\n      // 当前context有rotate/scale，重置matrix\n      context.setTransformForCurrent();\n    }\n\n    const customPath = new CustomPath2D();\n\n    const {\n      fill = arcAttribute.fill,\n      stroke = arcAttribute.stroke,\n      lineWidth = arcAttribute.lineWidth,\n      outerRadius = arcAttribute.outerRadius,\n      innerRadius = arcAttribute.innerRadius,\n      maxRandomnessOffset = defaultRouthThemeSpec.maxRandomnessOffset,\n      roughness = defaultRouthThemeSpec.roughness,\n      bowing = defaultRouthThemeSpec.bowing,\n      curveFitting = defaultRouthThemeSpec.curveFitting,\n      curveTightness = defaultRouthThemeSpec.curveTightness,\n      curveStepCount = defaultRouthThemeSpec.curveStepCount,\n      fillStyle = defaultRouthThemeSpec.fillStyle,\n      fillWeight = defaultRouthThemeSpec.fillWeight,\n      hachureAngle = defaultRouthThemeSpec.hachureAngle,\n      hachureGap = defaultRouthThemeSpec.hachureGap,\n      simplification = defaultRouthThemeSpec.simplification,\n      dashOffset = defaultRouthThemeSpec.dashOffset,\n      dashGap = defaultRouthThemeSpec.dashGap,\n      zigzagOffset = defaultRouthThemeSpec.zigzagOffset,\n      seed = defaultRouthThemeSpec.seed,\n      fillLineDash = defaultRouthThemeSpec.fillLineDash,\n      fillLineDashOffset = defaultRouthThemeSpec.fillLineDashOffset,\n      disableMultiStroke = defaultRouthThemeSpec.disableMultiStroke,\n      disableMultiStrokeFill = defaultRouthThemeSpec.disableMultiStrokeFill,\n      preserveVertices = defaultRouthThemeSpec.preserveVertices,\n      fixedDecimalPlaceDigits = defaultRouthThemeSpec.fixedDecimalPlaceDigits\n    } = arc.attribute as any;\n\n    drawArcPath(arc, customPath, x, y, outerRadius, innerRadius);\n\n    rc.path(customPath.toString(), {\n      fill: fill ? (fill as string) : undefined,\n      stroke: stroke ? (stroke as string) : undefined,\n      strokeWidth: lineWidth,\n      maxRandomnessOffset,\n      roughness,\n      bowing,\n      curveFitting,\n      curveTightness,\n      curveStepCount,\n      fillStyle,\n      fillWeight,\n      hachureAngle,\n      hachureGap,\n      simplification,\n      dashOffset,\n      dashGap,\n      zigzagOffset,\n      seed,\n      fillLineDash,\n      fillLineDashOffset,\n      disableMultiStroke,\n      disableMultiStrokeFill,\n      preserveVertices,\n      fixedDecimalPlaceDigits\n    });\n\n    context.highPerformanceRestore();\n  }\n\n  drawShape(\n    graphic: IGraphic,\n    ctx: IContext2d,\n    x: number,\n    y: number,\n    drawContext: IDrawContext,\n    params?: IGraphicRenderDrawParams,\n    fillCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean,\n    strokeCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean\n  ): void {\n    if (this.canvasRenderer.drawShape) {\n      return this.canvasRenderer.drawShape(graphic, ctx, x, y, drawContext, params, fillCb, strokeCb);\n    }\n  }\n}\n"]}