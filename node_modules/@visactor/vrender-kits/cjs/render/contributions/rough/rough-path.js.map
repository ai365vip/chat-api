{"version":3,"sources":["../src/render/contributions/rough/rough-path.ts"],"names":[],"mappings":"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","file":"rough-path.js","sourcesContent":["import type {\n  IGraphicRender,\n  IRenderService,\n  IGraphic,\n  IContext2d,\n  IMarkAttribute,\n  IThemeAttribute,\n  IGraphicAttribute,\n  IPath,\n  IDrawContext,\n  IGraphicRenderDrawParams\n} from '@visactor/vrender-core';\nimport { PATH_NUMBER_TYPE, DefaultCanvasPathRender, getTheme, inject, injectable } from '@visactor/vrender-core';\nimport rough from 'roughjs';\nimport { defaultRouthThemeSpec } from './config';\n\n@injectable()\nexport class RoughCanvasPathRender implements IGraphicRender {\n  type: 'path';\n  numberType: number;\n  style: 'rough' = 'rough';\n\n  constructor(\n    @inject(DefaultCanvasPathRender)\n    public readonly canvasRenderer: IGraphicRender\n  ) {\n    this.type = 'path';\n    this.numberType = PATH_NUMBER_TYPE;\n  }\n\n  draw(path: IPath, renderService: IRenderService, drawContext: IDrawContext, params?: IGraphicRenderDrawParams) {\n    const { context } = drawContext;\n    if (!context) {\n      return;\n    }\n\n    // 获取到原生canvas\n    const canvas = context.canvas.nativeCanvas;\n    const rc = rough.canvas(canvas, {});\n\n    context.highPerformanceSave();\n\n    const pathAttribute = getTheme(path).path;\n    context.transformFromMatrix(path.transMatrix, true);\n\n    const {\n      fill = pathAttribute.fill,\n      stroke = pathAttribute.stroke,\n      lineWidth = pathAttribute.lineWidth,\n      path: p = pathAttribute.path,\n      maxRandomnessOffset = defaultRouthThemeSpec.maxRandomnessOffset,\n      roughness = defaultRouthThemeSpec.roughness,\n      bowing = defaultRouthThemeSpec.bowing,\n      curveFitting = defaultRouthThemeSpec.curveFitting,\n      curveTightness = defaultRouthThemeSpec.curveTightness,\n      curveStepCount = defaultRouthThemeSpec.curveStepCount,\n      fillStyle = defaultRouthThemeSpec.fillStyle,\n      fillWeight = defaultRouthThemeSpec.fillWeight,\n      hachureAngle = defaultRouthThemeSpec.hachureAngle,\n      hachureGap = defaultRouthThemeSpec.hachureGap,\n      simplification = defaultRouthThemeSpec.simplification,\n      dashOffset = defaultRouthThemeSpec.dashOffset,\n      dashGap = defaultRouthThemeSpec.dashGap,\n      zigzagOffset = defaultRouthThemeSpec.zigzagOffset,\n      seed = defaultRouthThemeSpec.seed,\n      fillLineDash = defaultRouthThemeSpec.fillLineDash,\n      fillLineDashOffset = defaultRouthThemeSpec.fillLineDashOffset,\n      disableMultiStroke = defaultRouthThemeSpec.disableMultiStroke,\n      disableMultiStrokeFill = defaultRouthThemeSpec.disableMultiStrokeFill,\n      preserveVertices = defaultRouthThemeSpec.preserveVertices,\n      fixedDecimalPlaceDigits = defaultRouthThemeSpec.fixedDecimalPlaceDigits\n    } = path.attribute as any;\n    if (typeof p === 'string') {\n      rc.path(p, {\n        fill: fill ? (fill as string) : undefined,\n        stroke: stroke ? (stroke as string) : undefined,\n        strokeWidth: lineWidth,\n        maxRandomnessOffset,\n        roughness,\n        bowing,\n        curveFitting,\n        curveTightness,\n        curveStepCount,\n        fillStyle,\n        fillWeight,\n        hachureAngle,\n        hachureGap,\n        simplification,\n        dashOffset,\n        dashGap,\n        zigzagOffset,\n        seed,\n        fillLineDash,\n        fillLineDashOffset,\n        disableMultiStroke,\n        disableMultiStrokeFill,\n        preserveVertices,\n        fixedDecimalPlaceDigits\n      });\n    }\n\n    context.highPerformanceRestore();\n  }\n  drawShape(\n    graphic: IGraphic,\n    ctx: IContext2d,\n    x: number,\n    y: number,\n    drawContext: IDrawContext,\n    params?: IGraphicRenderDrawParams,\n    fillCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean,\n    strokeCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean\n  ): void {\n    if (this.canvasRenderer.drawShape) {\n      return this.canvasRenderer.drawShape(graphic, ctx, x, y, drawContext, params, fillCb, strokeCb);\n    }\n  }\n}\n"]}