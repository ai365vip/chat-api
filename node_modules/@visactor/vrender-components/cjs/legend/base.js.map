{"version":3,"sources":["../src/legend/base.ts"],"names":[],"mappings":"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","file":"base.js","sourcesContent":["/**\n * TODO:\n * align 为 'top' 时，操作区域同标题的间距有问题\n */\nimport { isValid, normalizePadding } from '@visactor/vutils';\nimport type { IGroup, INode } from '@visactor/vrender-core';\nimport { graphicCreator } from '@visactor/vrender-core';\nimport { AbstractComponent } from '../core/base';\nimport type { TagAttributes } from '../tag';\nimport { Tag } from '../tag';\nimport type { LegendBaseAttributes, LegendTitle } from './type';\nimport { LEGEND_ELEMENT_NAME } from './constant';\n\nexport abstract class LegendBase<T extends LegendBaseAttributes> extends AbstractComponent<Required<T>> {\n  name = 'legend';\n  protected _innerView!: IGroup;\n  protected _title: Tag | null = null;\n\n  render() {\n    this.removeAllChild();\n\n    const { interactive = true, title, padding = 0 } = this.attribute;\n    const parsedPadding = normalizePadding(padding);\n\n    // 创建一个内部的 container 用于存储所有的元素\n    const innerView = graphicCreator.group({\n      x: parsedPadding[3],\n      y: parsedPadding[0],\n      pickable: interactive,\n      childrenPickable: interactive\n    });\n    innerView.name = LEGEND_ELEMENT_NAME.innerView;\n    this.add(innerView);\n    this._innerView = innerView;\n\n    if (title?.visible) {\n      // 渲染标题\n      this._renderTitle(title);\n    }\n\n    this._renderContent();\n\n    this._adjustLayout();\n\n    if (interactive) {\n      this._bindEvents();\n    }\n\n    const viewBounds = this._innerView.AABBBounds;\n    this.attribute.width = viewBounds.width() + parsedPadding[1] + parsedPadding[3];\n    this.attribute.height = viewBounds.height() + parsedPadding[0] + parsedPadding[2];\n  }\n  /**\n   * 图例主体内容渲染\n   */\n  protected abstract _renderContent(): void;\n  /**\n   * 事件绑定逻辑\n   */\n  protected abstract _bindEvents(): void;\n\n  private _renderTitle(title: LegendTitle) {\n    const { text = '', textStyle, padding = 0, background, minWidth, maxWidth, shape } = title;\n\n    const tagAttrs: TagAttributes = {\n      x: 0,\n      y: 0,\n      text,\n      textStyle,\n      padding: normalizePadding(padding),\n      minWidth,\n      maxWidth\n    };\n\n    if (shape && shape.visible) {\n      tagAttrs.shape = {\n        visible: true,\n        ...shape.style\n      };\n      if (isValid(shape.space)) {\n        tagAttrs.space = shape.space;\n      }\n    }\n\n    if (background && background.visible) {\n      tagAttrs.panel = {\n        visible: true,\n        ...background.style\n      };\n    }\n\n    const titleTag = new Tag(tagAttrs);\n    titleTag.name = LEGEND_ELEMENT_NAME.title;\n    this._title = titleTag;\n\n    this._innerView.add(titleTag as unknown as INode);\n  }\n\n  private _adjustLayout() {\n    // 调整 title\n    if (this._title) {\n      const innerViewWidth = this._innerView.AABBBounds.width();\n      const titleWidth = this._title.AABBBounds.width();\n\n      const align = this.attribute.title?.align;\n      if (align === 'center') {\n        this._title.setAttribute('x', (innerViewWidth - titleWidth) / 2);\n      } else if (align === 'end') {\n        this._title.setAttribute('x', innerViewWidth - titleWidth);\n      }\n    }\n  }\n}\n"]}