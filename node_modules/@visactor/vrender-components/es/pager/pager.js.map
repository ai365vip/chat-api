{"version":3,"sources":["../src/pager/pager.ts"],"names":[],"mappings":"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","file":"pager.js","sourcesContent":["/**\n * @description 翻页器\n */\nimport type { ISymbol, IText, FederatedPointerEvent } from '@visactor/vrender-core';\n// eslint-disable-next-line no-duplicate-imports\nimport { graphicCreator } from '@visactor/vrender-core';\nimport { merge, normalizePadding, isNumber } from '@visactor/vutils';\nimport { AbstractComponent } from '../core/base';\nimport { measureTextSize } from '../util';\nimport type { PagerAttributes } from './type';\nimport type { ComponentOptions } from '../interface';\nimport { loadPagerComponent } from './register';\n\nconst DEFAULT_HANDLER_STYLE: PagerAttributes['handler'] = {\n  space: 8,\n  style: {\n    fill: 'rgb(47, 69, 84)',\n    cursor: 'pointer',\n    size: 15\n  },\n  state: {\n    disable: {\n      fill: 'rgb(170, 170, 170)',\n      cursor: 'not-allowed'\n    },\n    hover: {}\n  }\n};\n\nloadPagerComponent();\n\nexport class Pager extends AbstractComponent<Required<PagerAttributes>> {\n  name = 'pager';\n\n  private _current = 1;\n  getCurrent() {\n    return this._current;\n  }\n\n  private _total!: number;\n  preHandler!: ISymbol | null;\n  nextHandler!: ISymbol | null;\n  text!: IText | null;\n\n  static defaultAttributes: Partial<PagerAttributes> = {\n    handler: DEFAULT_HANDLER_STYLE,\n    textStyle: {\n      fill: 'rgb(51, 51, 51)',\n      fontSize: 12\n    }\n  };\n\n  constructor(attributes: PagerAttributes, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, Pager.defaultAttributes, attributes));\n  }\n\n  protected render() {\n    this._reset();\n    const {\n      layout = 'horizontal',\n      handler = DEFAULT_HANDLER_STYLE,\n      total,\n      defaultCurrent = 1,\n      textStyle,\n      padding = 0\n    } = this.attribute;\n\n    this._current = defaultCurrent;\n    const parsedPadding = normalizePadding(padding);\n    const isHorizontal = layout === 'horizontal';\n\n    const container = graphicCreator.group({\n      x: 0,\n      y: 0\n    });\n\n    const handlerStyle = handler.style || {};\n    const handlerSize = handlerStyle.size || 15;\n    const handlerSpace = handler.space ?? 8;\n    const handlerState = handler.state || {};\n\n    let { preShape, nextShape } = handler;\n    if (!preShape) {\n      preShape = isHorizontal ? 'triangleLeft' : 'triangleUp';\n    }\n    if (!nextShape) {\n      nextShape = isHorizontal ? 'triangleRight' : 'triangleDown';\n    }\n\n    const preHandler = graphicCreator.symbol({\n      strokeBoundsBuffer: 0,\n      pickMode: 'imprecise',\n      ...handlerStyle,\n      x: 0,\n      y: 0,\n      symbolType: preShape,\n      size: handlerSize\n    });\n    preHandler.states = handlerState;\n    preHandler.name = 'preHandler';\n    this.preHandler = preHandler;\n    container.add(preHandler);\n\n    // 获取文本的最大长度，如果不固定的话随着文本的变化整体会发生抖动\n    const { width: maxTextWidth, height: maxTextHeight } = measureTextSize(\n      `${total}/${total}`,\n      {\n        textAlign: 'center',\n        textBaseline: 'middle',\n        ...textStyle\n      },\n      this.stage?.getTheme().text.fontFamily\n    );\n\n    const handlerSizeX = isNumber(handlerSize) ? handlerSize : handlerSize[0];\n    const handlerSizeY = isNumber(handlerSize) ? handlerSize : handlerSize[1];\n\n    const text = graphicCreator.text({\n      x: isHorizontal ? handlerSizeX / 2 + handlerSpace + maxTextWidth / 2 : 0,\n      y: isHorizontal ? 0 : handlerSizeY / 2 + handlerSpace + maxTextHeight / 2,\n      text: `${defaultCurrent}/${total}`,\n      textAlign: 'center',\n      textBaseline: 'middle',\n      lineHeight: textStyle?.fontSize,\n      ...textStyle\n    });\n    this.text = text;\n    container.add(text);\n\n    const nextHandler = graphicCreator.symbol({\n      strokeBoundsBuffer: 0,\n      pickMode: 'imprecise',\n      ...handlerStyle,\n      x: isHorizontal ? handlerSizeX + handlerSpace * 2 + maxTextWidth : 0,\n      y: isHorizontal ? 0 : handlerSizeY + handlerSpace * 2 + maxTextHeight,\n      symbolType: nextShape,\n      size: handlerSize\n    });\n    nextHandler.name = 'nextHandler';\n    nextHandler.states = handlerState;\n    this.nextHandler = nextHandler;\n\n    container.add(nextHandler);\n\n    if (this._total === 1) {\n      preHandler.addState('disable');\n      nextHandler.addState('disable');\n    } else if (this._current === 1) {\n      preHandler.addState('disable');\n    } else if (this._current === total) {\n      nextHandler.addState('disable');\n    }\n\n    const containerBounds = container.AABBBounds;\n    const width = containerBounds.width();\n    const height = containerBounds.height();\n\n    container.translateTo(0 - containerBounds.x1 + parsedPadding[3], 0 - containerBounds.y1 + parsedPadding[0]);\n    this.add(container);\n\n    this.attribute.width = width + parsedPadding[1] + parsedPadding[3];\n    this.attribute.height = height + parsedPadding[0] + parsedPadding[2];\n\n    this._bindEvents();\n  }\n\n  private _bindEvents(): void {\n    if (this.attribute.disableTriggerEvent) {\n      return;\n    }\n    if (this.preHandler) {\n      this.preHandler.addEventListener('pointerenter', this._onHover as EventListenerOrEventListenerObject);\n      this.preHandler.addEventListener('pointerleave', this._onUnHover as EventListenerOrEventListenerObject);\n      this.preHandler.addEventListener('pointerdown', this._onClick as EventListenerOrEventListenerObject);\n    }\n\n    if (this.nextHandler) {\n      this.nextHandler.addEventListener('pointerenter', this._onHover as EventListenerOrEventListenerObject);\n      this.nextHandler.addEventListener('pointerleave', this._onUnHover as EventListenerOrEventListenerObject);\n      this.nextHandler.addEventListener('pointerdown', this._onClick as EventListenerOrEventListenerObject);\n    }\n  }\n\n  private _onHover = (e: FederatedPointerEvent) => {\n    const target = e.target as unknown as ISymbol;\n    if (!target.hasState('disable')) {\n      target.addState('hover');\n    }\n  };\n\n  private _onUnHover = (e: FederatedPointerEvent) => {\n    const target = e.target as unknown as ISymbol;\n    target.removeState('hover');\n  };\n\n  private _onClick = (e: FederatedPointerEvent) => {\n    const target = e.target as unknown as ISymbol;\n    if (target.name === 'preHandler') {\n      if (this._current === 1) {\n        return;\n      }\n      this._current -= 1;\n      if (this._current === 1) {\n        target.addState('disable');\n      } else {\n        target.removeState('disable');\n      }\n\n      this._dispatchEvent('toPrev', {\n        current: this._current,\n        total: this._total,\n        direction: 'pre',\n        event: e\n      });\n    }\n\n    if (target.name === 'nextHandler') {\n      if (this._current === this._total) {\n        return;\n      }\n      this._current += 1;\n\n      if (this._current === this._total) {\n        target.addState('disable');\n      } else {\n        target.removeState('disable');\n      }\n\n      this._dispatchEvent('toNext', {\n        current: this._current,\n        total: this._total,\n        direction: 'next',\n        event: e\n      });\n    }\n\n    if (this._current > 1) {\n      (this.preHandler as ISymbol).removeState('disable');\n    }\n    if (this._current < this._total) {\n      (this.nextHandler as ISymbol).removeState('disable');\n    }\n\n    (this.text as IText).setAttribute('text', `${this._current}/${this._total}`);\n  };\n\n  private _reset() {\n    this.removeAllChild();\n    this._current = 1;\n    this._total = this.attribute.total as number;\n    this.preHandler = this.nextHandler = this.text = null;\n  }\n}\n"]}