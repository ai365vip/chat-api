{"version":3,"sources":["../src/player/controller/controller.ts"],"names":[],"mappings":"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","file":"controller.js","sourcesContent":["import { isNil, merge } from '@visactor/vutils';\nimport type { FederatedPointerEvent, ISymbolGraphicAttribute } from '@visactor/vrender-core';\nimport { AbstractComponent } from '../../core/base';\nimport type { BaseGraphicAttributes } from '../../core/type';\nimport type { ControllerAttributes, LayoutType } from './type';\nimport { iconRight, iconPause, iconPlay, iconLeft, iconUp, iconDown } from './assets';\nimport { PlayerIcon } from './icon';\nimport { ControllerTypeEnum } from './constant';\nimport type { ComponentOptions } from '../../interface';\n\nexport class Controller extends AbstractComponent<Required<ControllerAttributes>> {\n  static defaultControllerAttr: ISymbolGraphicAttribute = {\n    visible: true,\n    x: 0,\n    y: 0,\n    size: 20,\n    fill: '#91caff',\n    pickMode: 'imprecise',\n    cursor: 'pointer'\n  };\n  static defaultAttributes: ControllerAttributes = {\n    [ControllerTypeEnum.Start]: {},\n    [ControllerTypeEnum.Pause]: {},\n    [ControllerTypeEnum.Backward]: {},\n    [ControllerTypeEnum.Forward]: {}\n  };\n\n  private _isPaused = true;\n  private _playController: PlayerIcon;\n  private _forwardController: PlayerIcon;\n  private _backwardController: PlayerIcon;\n\n  private _layout: LayoutType;\n  private _startAttr: BaseGraphicAttributes<ISymbolGraphicAttribute>;\n  private _pauseAttr: BaseGraphicAttributes<ISymbolGraphicAttribute>;\n  private _forwardAttr: BaseGraphicAttributes<ISymbolGraphicAttribute>;\n  private _backwardAttr: BaseGraphicAttributes<ISymbolGraphicAttribute>;\n\n  constructor(attributes: ControllerAttributes, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, Controller.defaultAttributes, attributes));\n    this.updateAttributes();\n    this._initPlay();\n    this._initBackward();\n    this._initForward();\n    this._initEvents();\n  }\n\n  updateAttributes = () => {\n    this._startAttr = {\n      style: {\n        symbolType: iconPlay,\n        ...Controller.defaultControllerAttr,\n        visible: this.attribute.start.visible,\n        ...this.attribute.start.style\n      }\n    };\n    this._pauseAttr = {\n      style: {\n        symbolType: iconPause,\n        ...Controller.defaultControllerAttr,\n        visible: this.attribute.pause.visible,\n        ...this.attribute.pause.style\n      }\n    };\n    this._forwardAttr = {\n      style: {\n        ...Controller.defaultControllerAttr,\n        visible: this.attribute.forward.visible,\n        ...this.attribute.forward.style\n      }\n    };\n    this._backwardAttr = {\n      style: {\n        ...Controller.defaultControllerAttr,\n        visible: this.attribute.backward.visible,\n        ...this.attribute.backward.style\n      }\n    };\n    this.updateLayout();\n  };\n\n  private updateLayout = () => {\n    this._layout = this.attribute.layout;\n    // 若水平布局\n    if (this._layout === 'horizontal') {\n      this._backwardAttr.style.symbolType = this._backwardAttr.style.symbolType ?? iconLeft;\n      this._forwardAttr.style.symbolType = this._forwardAttr.style.symbolType ?? iconRight;\n    }\n    // 若垂直布局\n    else if (this._layout === 'vertical') {\n      this._backwardAttr.style.symbolType = this._backwardAttr.style.symbolType ?? iconUp;\n      this._forwardAttr.style.symbolType = this._forwardAttr.style.symbolType ?? iconDown;\n    }\n  };\n\n  private _initPlay = () => {\n    if (isNil(this._playController)) {\n      this._playController = new PlayerIcon({\n        ...this._startAttr.style\n      });\n\n      this.add(this._playController);\n    }\n  };\n\n  private _initBackward = () => {\n    if (isNil(this._backwardController)) {\n      this._backwardController = new PlayerIcon({\n        ...this._backwardAttr.style\n      });\n\n      this.add(this._backwardController);\n    }\n  };\n\n  private _initForward = () => {\n    if (isNil(this._forwardController)) {\n      this._forwardController = new PlayerIcon({\n        ...this._forwardAttr.style\n      });\n\n      this.add(this._forwardController);\n    }\n  };\n\n  /**\n   * 初始化事件\n   * 1. 注册\n   */\n  private _initEvents = () => {\n    if (this.attribute.disableTriggerEvent) {\n      return;\n    }\n    this._playController.addEventListener('pointerdown', (e: FederatedPointerEvent) => {\n      e.stopPropagation();\n\n      if (this._isPaused === true) {\n        this.play();\n      } else {\n        this.pause();\n      }\n    });\n\n    this._backwardController.addEventListener('pointerdown', (e: FederatedPointerEvent) => {\n      e.stopPropagation();\n      this.backward();\n    });\n\n    this._forwardController.addEventListener('pointerdown', (e: FederatedPointerEvent) => {\n      e.stopPropagation();\n      this.forward();\n    });\n  };\n\n  render(): void {\n    this.updateAttributes();\n    this.renderPlay();\n    this.renderBackward();\n    this.renderForward();\n  }\n\n  renderPlay = () => {\n    if (this._isPaused) {\n      this._playController.setAttributes({\n        symbolType: this._playController.getComputedAttribute('symbolType'),\n        ...this._startAttr.style\n      });\n    } else {\n      this._playController.setAttributes({\n        symbolType: this._playController.getComputedAttribute('symbolType'),\n        ...this._pauseAttr.style\n      });\n    }\n  };\n\n  renderBackward = () => {\n    this._backwardController.setAttributes(this._backwardAttr.style);\n  };\n\n  renderForward = () => {\n    this._forwardController.setAttributes(this._forwardAttr.style);\n  };\n\n  play = () => {\n    this._dispatchEvent('ControllerEventEnum.OnPlay');\n  };\n\n  pause = () => {\n    this._dispatchEvent('ControllerEventEnum.OnPause');\n  };\n\n  forward = () => {\n    this._dispatchEvent('ControllerEventEnum.OnForward');\n  };\n\n  backward = () => {\n    this._dispatchEvent('ControllerEventEnum.OnBackward');\n  };\n\n  togglePlay = () => {\n    this._playController.setAttributes(this._startAttr.style);\n    this._isPaused = true;\n  };\n\n  togglePause = () => {\n    this._playController.setAttributes(this._pauseAttr.style);\n    this._isPaused = false;\n  };\n}\n"]}