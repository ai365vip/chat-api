{"version":3,"sources":["../src/axis/circle.ts"],"names":[],"mappings":"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","file":"circle.js","sourcesContent":["/**\n * @description 圆弧型坐标轴\n */\nimport type { IGroup, IText, ITextGraphicAttribute, TextAlignType, TextBaselineType } from '@visactor/vrender-core';\n// eslint-disable-next-line no-duplicate-imports\nimport { graphicCreator } from '@visactor/vrender-core';\n// eslint-disable-next-line no-duplicate-imports\nimport type { Point } from '@visactor/vutils';\nimport { isNil, get, merge, isNumberClose, isEmpty, mixin } from '@visactor/vutils';\nimport { POLAR_END_ANGLE, POLAR_START_ANGLE } from '../constant';\nimport type { CircleAxisAttributes, TitleAttributes, SubTickAttributes, TickLineItem, AxisItem } from './type';\nimport { AxisBase } from './base';\nimport { DEFAULT_AXIS_THEME } from './config';\nimport { AXIS_ELEMENT_NAME, DEFAULT_STATES } from './constant';\nimport { CircleAxisMixin } from './mixin/circle';\nimport { getLabelPosition } from './util';\nimport type { ComponentOptions } from '../interface';\nimport { loadCircleAxisComponent } from './register';\n\nloadCircleAxisComponent();\nexport interface CircleAxis\n  extends Pick<CircleAxisMixin, 'isInValidValue' | 'getTickCoord' | 'getVerticalVector' | 'getRelativeVector'>,\n    AxisBase<CircleAxisAttributes> {}\n\nexport class CircleAxis extends AxisBase<CircleAxisAttributes> {\n  static defaultAttributes = DEFAULT_AXIS_THEME;\n\n  constructor(attributes: CircleAxisAttributes, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, CircleAxis.defaultAttributes, attributes));\n  }\n\n  protected renderLine(container: IGroup): void {\n    const {\n      startAngle = POLAR_START_ANGLE,\n      endAngle = POLAR_END_ANGLE,\n      radius,\n      center,\n      innerRadius = 0,\n      line = {},\n      inside = false\n    } = this.attribute as CircleAxisAttributes;\n\n    let arcRadius = radius;\n    let arcInnerRadius = innerRadius;\n    if (inside && innerRadius > 0) {\n      arcRadius = innerRadius;\n      arcInnerRadius = 0;\n    }\n\n    const arcAttrs = {\n      ...center,\n      startAngle,\n      endAngle,\n      radius: arcRadius,\n      innerRadius: arcInnerRadius,\n      ...line.style\n    };\n    const axisLine = graphicCreator.circle(arcAttrs);\n    axisLine.name = AXIS_ELEMENT_NAME.line;\n    axisLine.id = this._getNodeId('line');\n\n    if (!isEmpty(line.state)) {\n      axisLine.states = merge({}, DEFAULT_STATES, line.state);\n    }\n    container.add(axisLine);\n  }\n\n  protected getTitleAttribute() {\n    const { center, radius, innerRadius = 0 } = this.attribute as CircleAxisAttributes;\n    const {\n      space = 4,\n      textStyle = {},\n      shape,\n      background,\n      state = {},\n      ...restAttrs\n    } = this.attribute.title as TitleAttributes;\n    let titlePoint = center;\n    let labelHeight = 0;\n    if (this.attribute.label?.visible && this.attribute.label.inside === false) {\n      // 这里取 label 的最大长度\n      labelHeight = get(this.attribute.label, 'style.fontSize', 12) + get(this.attribute.label, 'space', 4);\n    }\n    let tickLength = 0;\n    if (this.attribute.tick?.visible && this.attribute.tick.inside === false) {\n      tickLength = this.attribute.tick.length || 4;\n    }\n    if (this.attribute.subTick?.visible && this.attribute.subTick.inside === false) {\n      tickLength = Math.max(tickLength, this.attribute.subTick.length || 2);\n    }\n    const offset = radius + tickLength + labelHeight + space;\n    let textBaseline: TextBaselineType = 'middle';\n    let { position } = this.attribute.title as TitleAttributes;\n    if (isNil(position)) {\n      position = innerRadius === 0 ? 'end' : 'middle';\n    }\n    if (position === 'start') {\n      textBaseline = 'bottom';\n      titlePoint = {\n        x: center.x,\n        y: center.y - offset\n      };\n    } else if (position === 'end') {\n      textBaseline = 'top';\n      titlePoint = {\n        x: center.x,\n        y: center.y + offset\n      };\n    }\n    const attrs: any = {\n      ...titlePoint,\n      ...restAttrs,\n      textStyle: {\n        textBaseline,\n        textAlign: 'center',\n        ...textStyle\n      },\n      state: {\n        text: merge({}, DEFAULT_STATES, state.text),\n        shape: merge({}, DEFAULT_STATES, state.shape),\n        panel: merge({}, DEFAULT_STATES, state.background)\n      }\n    };\n\n    const { angle } = restAttrs; // 用户设置的是角度\n    attrs.angle = angle;\n\n    if (shape && shape.visible) {\n      attrs.shape = {\n        visible: true,\n        ...shape.style\n      };\n      if (shape.space) {\n        attrs.space = shape.space;\n      }\n    }\n\n    if (background && background.visible) {\n      attrs.panel = {\n        visible: true,\n        ...background.style\n      };\n    }\n\n    return attrs;\n  }\n\n  protected getSubTickLineItems() {\n    const { subTick } = this.attribute as CircleAxisAttributes;\n    const subTickLineItems: TickLineItem[] = [];\n    const { count: subCount = 4, inside = false, length = 2 } = subTick as SubTickAttributes;\n    const tickLineItems = this.tickLineItems;\n    const tickLineCount = tickLineItems.length;\n    // 刻度线的数量大于 2 时，才绘制子刻度\n    if (tickLineCount >= 2) {\n      const tickSegment = this.data[1].value - this.data[0].value;\n      const isAlignWithLable = this.attribute?.tick?.alignWithLabel;\n      for (let i = 0; i < tickLineCount; i++) {\n        const pre = tickLineItems[i];\n        const next = tickLineItems[i + 1];\n        for (let j = 0; j < subCount; j++) {\n          const percent = (j + 1) / (subCount + 1);\n          const value =\n            (1 - percent) * pre.value + percent * (next ? next.value : isAlignWithLable ? 1 : pre.value + tickSegment);\n          const point = this.getTickCoord(value);\n          const endPoint = this.getVerticalCoord(point, length, inside);\n          subTickLineItems.push({\n            start: point,\n            end: endPoint,\n            value\n          });\n        }\n      }\n    }\n\n    return subTickLineItems;\n  }\n\n  protected getTextBaseline(vector: number[]): TextBaselineType {\n    let base: TextBaselineType = 'middle';\n    if (isNumberClose(vector[1], 0)) {\n      base = 'middle';\n    } else if (vector[1] > 0 && vector[1] > Math.abs(vector[0])) {\n      base = 'top';\n    } else if (vector[1] < 0 && Math.abs(vector[1]) > Math.abs(vector[0])) {\n      base = 'bottom';\n    }\n    return base;\n  }\n\n  protected beforeLabelsOverlap(\n    labelShapes: IText[],\n    labelData: AxisItem[],\n    labelContainer: IGroup,\n    layer: number,\n    layerCount: number\n  ): void {\n    return;\n  }\n  protected handleLabelsOverlap(\n    labelShapes: IText[],\n    labelData: AxisItem[],\n    labelContainer: IGroup,\n    layer: number,\n    layerCount: number\n  ): void {\n    // 暂不支持\n    return;\n  }\n  protected afterLabelsOverlap(\n    labelShapes: IText[],\n    labelData: AxisItem[],\n    labelContainer: IGroup,\n    layer: number,\n    layerCount: number\n  ): void {\n    return;\n  }\n\n  protected getLabelAlign(\n    vector: [number, number],\n    inside?: boolean,\n    angle?: number\n  ): { textAlign: TextAlignType; textBaseline: TextBaselineType } {\n    return {\n      textAlign: 'center', //'left',\n      textBaseline: 'middle' //'top'\n    };\n  }\n\n  protected getLabelPosition(\n    point: Point,\n    vector: [number, number],\n    text: string | number,\n    style: Partial<ITextGraphicAttribute>\n  ) {\n    return getLabelPosition(point, vector, text, style);\n  }\n}\n\nmixin(CircleAxis, CircleAxisMixin);\n"]}